<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ekran G√∂r√ºnt√ºs√º ve Kayƒ±t Uygulamasƒ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2196F3;
            --secondary: #9C27B0;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #eeeeee;
            --text-primary: #212121;
            --text-secondary: #757575;
            --border-color: #e0e0e0;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.15);
        }

        [data-theme="dark"] {
            --bg-primary: #1e1e1e;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3d3d3d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-color: #404040;
            --shadow: 0 2px 8px rgba(0,0,0,0.3);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.4);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .app-header {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: var(--primary);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        [data-theme="dark"] .btn-outline {
            color: var(--primary);
        }

        .btn-icon {
            padding: 10px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 8px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Theme Toggle */
        .theme-toggle {
            width: 50px;
            height: 26px;
            background: var(--bg-tertiary);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            border: 2px solid var(--border-color);
        }

        .theme-toggle-slider {
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            position: absolute;
            top: 1px;
            left: 2px;
            transition: transform 0.3s;
        }

        [data-theme="dark"] .theme-toggle-slider {
            transform: translateX(24px);
        }

        /* Tabs */
        .tabs {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: flex;
            gap: 10px;
        }

        .tab {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .tab:hover {
            background: var(--bg-tertiary);
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        select.form-control {
            cursor: pointer;
        }

        /* Checkbox and Radio */
        .checkbox-group, .radio-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        input[type="checkbox"], input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Slider */
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-tertiary);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: none;
        }

        /* Grid Layout */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        @media (max-width: 1024px) {
            .grid-4 { grid-template-columns: repeat(2, 1fr); }
            .grid-3 { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
        }

        /* Recording Controls */
        .recording-status {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
        }

        .recording-indicator {
            width: 20px;
            height: 20px;
            background: var(--danger);
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.9); }
        }

        .recording-timer {
            font-size: 48px;
            font-weight: 700;
            color: var(--text-primary);
            font-variant-numeric: tabular-nums;
        }

        .recording-size {
            font-size: 18px;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        /* Audio Meter */
        .audio-meter {
            height: 20px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .audio-meter-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--warning), var(--danger));
            width: 0%;
            transition: width 0.1s;
        }

        /* Preview Area */
        .preview-area {
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-video {
            width: 100%;
            max-height: 600px;
            display: block;
        }

        .preview-placeholder {
            color: #888;
            font-size: 18px;
        }

        /* Webcam Overlay */
        .webcam-overlay {
            position: absolute;
            width: 150px;
            height: 150px;
            border: 3px solid white;
            overflow: hidden;
            z-index: 10;
            cursor: move;
        }

        .webcam-overlay.circle {
            border-radius: 50%;
        }

        .webcam-overlay.rounded {
            border-radius: 12px;
        }

        .webcam-overlay video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Canvas Editor */
        .canvas-editor {
            position: relative;
            background: var(--bg-tertiary);
            border-radius: 12px;
            overflow: hidden;
            display: inline-block;
        }

        .canvas-editor canvas {
            display: block;
            max-width: 100%;
            height: auto;
        }

        /* Toolbar */
        .toolbar {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }

        .toolbar-separator {
            width: 1px;
            height: 30px;
            background: var(--border-color);
            margin: 0 4px;
        }

        .color-picker {
            width: 40px;
            height: 40px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
        }

        /* Library Grid */
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .library-item {
            background: var(--bg-primary);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .library-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .library-thumbnail {
            width: 100%;
            height: 180px;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .library-thumbnail img, .library-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .library-play-icon {
            position: absolute;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .library-info {
            padding: 16px;
        }

        .library-title {
            font-weight: 600;
            margin-bottom: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .library-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }

        .library-actions {
            padding: 12px 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 8px;
        }

        .library-actions button {
            flex: 1;
            padding: 6px 12px;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .library-actions button:hover {
            background: var(--primary);
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 24px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg-tertiary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 20px;
            color: var(--text-primary);
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        /* Countdown */
        .countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .countdown-overlay.active {
            display: flex;
        }

        .countdown-number {
            font-size: 120px;
            font-weight: 700;
            color: white;
            animation: countdownPulse 1s;
        }

        @keyframes countdownPulse {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: var(--shadow-lg);
            z-index: 3000;
            min-width: 300px;
            animation: slideInRight 0.3s;
            display: none;
        }

        .notification.active {
            display: block;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        .notification.success { border-left: 4px solid var(--success); }
        .notification.error { border-left: 4px solid var(--danger); }
        .notification.warning { border-left: 4px solid var(--warning); }
        .notification.info { border-left: 4px solid var(--primary); }

        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--bg-tertiary);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tooltip */
        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 6px 12px;
            background: rgba(0,0,0,0.9);
            color: white;
            border-radius: 6px;
            white-space: nowrap;
            font-size: 12px;
            z-index: 100;
            margin-bottom: 8px;
        }

        /* Search Bar */
        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 40px 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Range Display */
        .range-value {
            display: inline-block;
            min-width: 60px;
            text-align: right;
            font-weight: 600;
            color: var(--primary);
        }

        /* Video Player Controls */
        .video-player {
            background: #000;
            border-radius: 12px;
            overflow: hidden;
        }

        .video-player video {
            width: 100%;
            display: block;
        }

        .video-controls {
            background: rgba(0,0,0,0.8);
            padding: 12px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .video-controls button {
            background: transparent;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 6px 12px;
        }

        .video-controls button:hover {
            color: var(--primary);
        }

        .video-timeline {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .video-timeline-progress {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            pointer-events: none;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 18px;
            margin-bottom: 20px;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            background: var(--primary);
            color: white;
        }

        .badge.success { background: var(--success); }
        .badge.danger { background: var(--danger); }
        .badge.warning { background: var(--warning); }

        /* Floating Panel */
        .floating-panel {
            position: fixed;
            top: 100px;
            right: 20px;
            width: 300px;
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-lg);
            z-index: 999;
            display: none;
        }

        .floating-panel.active {
            display: block;
            animation: slideInRight 0.3s;
        }

        /* Settings Section */
        .settings-section {
            margin-bottom: 32px;
        }

        .settings-section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color);
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Area Selector Overlay */
        .area-selector-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            z-index: 9999;
            cursor: crosshair;
            display: none;
        }

        .area-selector-overlay.active {
            display: block;
        }

        .selection-box {
            position: absolute;
            border: 2px dashed var(--primary);
            background: rgba(33, 150, 243, 0.1);
        }

        /* Drawing Overlay */
        .drawing-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        .drawing-overlay.active {
            pointer-events: all;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-secondary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }

            .app-header {
                flex-direction: column;
                gap: 16px;
            }

            .recording-timer {
                font-size: 32px;
            }

            .notification {
                min-width: auto;
                right: 10px;
                left: 10px;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Utility Classes */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-4 { gap: 16px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-4 { margin-bottom: 16px; }
        .mt-2 { margin-top: 8px; }
        .mt-4 { margin-top: 16px; }
        .text-center { text-align: center; }
        .text-sm { font-size: 12px; }
        .text-lg { font-size: 18px; }
        .font-bold { font-weight: 700; }
        .hidden { display: none; }
    </style>
</head>
<body data-theme="light">
    <div class="app-container">
        <!-- Header -->
        <div class="app-header">
            <div class="app-title">
                üìπ Ekran G√∂r√ºnt√ºs√º ve Kayƒ±t Uygulamasƒ±
            </div>
            <div class="header-actions">
                <button class="btn-icon" data-tooltip="Ayarlar" onclick="openSettings()">‚öôÔ∏è</button>
                <button class="btn-icon" data-tooltip="Yardƒ±m" onclick="openHelp()">‚ùì</button>
                <div class="theme-toggle" onclick="toggleTheme()" data-tooltip="Tema Deƒüi≈ütir">
                    <div class="theme-toggle-slider"></div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('recording')">üé• Ekran Kaydƒ±</button>
            <button class="tab" onclick="switchTab('screenshot')">üì∏ Ekran G√∂r√ºnt√ºs√º</button>
            <button class="tab" onclick="switchTab('library')">üìö K√ºt√ºphane</button>
        </div>

        <!-- Recording Tab -->
        <div id="recording-tab" class="tab-content active">
            <div class="grid-2">
                <div>
                    <div class="card">
                        <div class="card-title">‚öôÔ∏è Kayƒ±t Ayarlarƒ±</div>

                        <div class="form-group">
                            <label class="form-label">Kayƒ±t Modu</label>
                            <select id="recordingMode" class="form-control">
                                <option value="screen">T√ºm Ekran</option>
                                <option value="window">Belirli Pencere</option>
                                <option value="tab">Tarayƒ±cƒ± Sekmesi</option>
                                <option value="area">Se√ßili Alan</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">√á√∂z√ºn√ºrl√ºk</label>
                            <select id="resolution" class="form-control">
                                <option value="2160">2160p (4K)</option>
                                <option value="1440">1440p</option>
                                <option value="1080" selected>1080p</option>
                                <option value="720">720p</option>
                                <option value="480">480p</option>
                                <option value="360">360p</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Kare Hƒ±zƒ± (FPS)</label>
                            <select id="framerate" class="form-control">
                                <option value="60">60 FPS</option>
                                <option value="30" selected>30 FPS</option>
                                <option value="24">24 FPS</option>
                                <option value="15">15 FPS</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Video Kalitesi</label>
                            <select id="quality" class="form-control">
                                <option value="ultra">Ultra</option>
                                <option value="high" selected>Y√ºksek</option>
                                <option value="medium">Orta</option>
                                <option value="low">D√º≈ü√ºk</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Bitrate (Mbps): <span class="range-value" id="bitrateValue">5</span></label>
                            <input type="range" id="bitrate" class="slider" min="1" max="20" value="5" step="1">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">üé§ Ses Ayarlarƒ±</div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="systemAudio" checked>
                            <label for="systemAudio">Sistem Sesi Kaydet</label>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Sistem Ses Seviyesi: <span class="range-value" id="systemVolumeValue">100%</span></label>
                            <input type="range" id="systemVolume" class="slider" min="0" max="100" value="100">
                            <div class="audio-meter mt-2">
                                <div class="audio-meter-bar" id="systemAudioMeter"></div>
                            </div>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="microphoneAudio" checked>
                            <label for="microphoneAudio">Mikrofon Kaydet</label>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Mikrofon Ses Seviyesi: <span class="range-value" id="micVolumeValue">100%</span></label>
                            <input type="range" id="micVolume" class="slider" min="0" max="100" value="100">
                            <div class="audio-meter mt-2">
                                <div class="audio-meter-bar" id="micAudioMeter"></div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">üìπ Webcam Ayarlarƒ±</div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="webcamEnabled">
                            <label for="webcamEnabled">Webcam Overlay Etkinle≈ütir</label>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Konum</label>
                            <select id="webcamPosition" class="form-control">
                                <option value="top-right" selected>Saƒü √úst</option>
                                <option value="top-left">Sol √úst</option>
                                <option value="bottom-right">Saƒü Alt</option>
                                <option value="bottom-left">Sol Alt</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Boyut</label>
                            <select id="webcamSize" class="form-control">
                                <option value="150">K√º√ß√ºk (150px)</option>
                                <option value="250" selected>Orta (250px)</option>
                                <option value="350">B√ºy√ºk (350px)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">≈ûekil</label>
                            <select id="webcamShape" class="form-control">
                                <option value="circle" selected>Daire</option>
                                <option value="square">Kare</option>
                                <option value="rounded">Yuvarlatƒ±lmƒ±≈ü Kare</option>
                            </select>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">üñ±Ô∏è Geli≈ümi≈ü √ñzellikler</div>

                        <div class="form-group">
                            <label class="form-label">Mouse ƒ∞mleci Efekti</label>
                            <select id="cursorEffect" class="form-control">
                                <option value="none" selected>Yok</option>
                                <option value="highlight">Tƒ±klamada Vurgula</option>
                                <option value="circle">ƒ∞mle√ß Etrafƒ±nda Daire</option>
                            </select>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="showKeystrokes">
                            <label for="showKeystrokes">Tu≈ü Vuru≈ülarƒ±nƒ± G√∂ster</label>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="countdown">
                            <label for="countdown">Ba≈ülamadan √ñnce Geri Sayƒ±m (3-2-1)</label>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Otomatik Durdurma (Dakika)</label>
                            <input type="number" id="autoStop" class="form-control" min="0" placeholder="0 = Sƒ±nƒ±rsƒ±z" value="0">
                        </div>
                    </div>
                </div>

                <div>
                    <div class="recording-status">
                        <div id="recordingIndicator" class="hidden">
                            <span class="recording-indicator"></span>
                            <span style="font-size: 18px; font-weight: 600;">KAYIT YAPARKEN</span>
                        </div>
                        <div class="recording-timer" id="recordingTimer">00:00:00</div>
                        <div class="recording-size" id="recordingSize">Tahmini Boyut: 0 MB</div>

                        <div style="margin-top: 30px; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-success" id="startRecordingBtn" onclick="startRecording()">
                                ‚è∫Ô∏è Kaydƒ± Ba≈ülat
                            </button>
                            <button class="btn btn-warning hidden" id="pauseRecordingBtn" onclick="pauseRecording()">
                                ‚è∏Ô∏è Duraklat
                            </button>
                            <button class="btn btn-danger hidden" id="stopRecordingBtn" onclick="stopRecording()">
                                ‚èπÔ∏è Durdur
                            </button>
                        </div>

                        <div style="margin-top: 20px;">
                            <button class="btn btn-outline" onclick="toggleDrawingMode()">
                                ‚úèÔ∏è √áizim Modu
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">üì∫ √ñnizleme</div>
                        <div class="preview-area" id="previewArea">
                            <video id="previewVideo" class="preview-video hidden" muted></video>
                            <div class="preview-placeholder" id="previewPlaceholder">
                                Kayƒ±t ba≈üladƒ±ƒüƒ±nda √∂nizleme burada g√∂r√ºnecek
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">‚å®Ô∏è Klavye Kƒ±sayollarƒ±</div>
                        <div style="font-size: 14px; line-height: 2;">
                            <div><strong>Ctrl+Shift+R:</strong> Kaydƒ± Ba≈ülat/Durdur</div>
                            <div><strong>Ctrl+Shift+P:</strong> Duraklat/Devam Et</div>
                            <div><strong>Ctrl+Shift+S:</strong> Kayƒ±t Sƒ±rasƒ±nda Ekran G√∂r√ºnt√ºs√º Al</div>
                            <div><strong>Ctrl+Shift+D:</strong> √áizim Modunu A√ß/Kapat</div>
                            <div><strong>Esc:</strong> Kaydƒ± ƒ∞ptal Et/Durdur</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Screenshot Tab -->
        <div id="screenshot-tab" class="tab-content">
            <div class="grid-2">
                <div>
                    <div class="card">
                        <div class="card-title">üì∏ Yakalama Modu</div>

                        <div class="form-group">
                            <label class="form-label">Mod Se√ßin</label>
                            <select id="screenshotMode" class="form-control">
                                <option value="full">T√ºm Ekran</option>
                                <option value="window">Aktif Pencere</option>
                                <option value="area">Se√ßili Alan</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Gecikme (Saniye)</label>
                            <select id="screenshotDelay" class="form-control">
                                <option value="0" selected>Gecikme Yok</option>
                                <option value="3">3 Saniye</option>
                                <option value="5">5 Saniye</option>
                                <option value="10">10 Saniye</option>
                            </select>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="includeCursor">
                            <label for="includeCursor">ƒ∞mleci Dahil Et</label>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="autoCopyClipboard">
                            <label for="autoCopyClipboard">Otomatik Panoya Kopyala</label>
                        </div>

                        <button class="btn btn-primary" onclick="takeScreenshot()" style="width: 100%; margin-top: 16px;">
                            üì∏ Ekran G√∂r√ºnt√ºs√º Al
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-title">üé® D√ºzenleme Ara√ßlarƒ±</div>
                        <div id="editingToolbar" class="toolbar hidden">
                            <button class="btn-icon" data-tooltip="Kƒ±rp" onclick="activateTool('crop')">‚úÇÔ∏è</button>
                            <button class="btn-icon" data-tooltip="Kalem" onclick="activateTool('pen')">‚úèÔ∏è</button>
                            <button class="btn-icon" data-tooltip="Vurgulayƒ±cƒ±" onclick="activateTool('highlighter')">üñçÔ∏è</button>
                            <button class="btn-icon" data-tooltip="Ok" onclick="activateTool('arrow')">‚û°Ô∏è</button>
                            <button class="btn-icon" data-tooltip="Dikd√∂rtgen" onclick="activateTool('rectangle')">‚ñ≠</button>
                            <button class="btn-icon" data-tooltip="Daire" onclick="activateTool('circle')">‚≠ï</button>
                            <button class="btn-icon" data-tooltip="Metin" onclick="activateTool('text')">T</button>
                            <button class="btn-icon" data-tooltip="Bulanƒ±kla≈ütƒ±r" onclick="activateTool('blur')">üå´Ô∏è</button>
                            <div class="toolbar-separator"></div>
                            <input type="color" id="drawColor" class="color-picker" value="#FF0000">
                            <input type="range" id="drawSize" class="slider" min="1" max="20" value="3" style="width: 100px;">
                            <div class="toolbar-separator"></div>
                            <button class="btn-icon" data-tooltip="Geri Al" onclick="undo()">‚Ü∂</button>
                            <button class="btn-icon" data-tooltip="ƒ∞leri Al" onclick="redo()">‚Ü∑</button>
                            <button class="btn-icon" data-tooltip="Sƒ±fƒ±rla" onclick="resetCanvas()">üîÑ</button>
                            <div class="toolbar-separator"></div>
                            <button class="btn btn-success" onclick="saveEditedImage()">üíæ Kaydet</button>
                        </div>
                        <div class="canvas-editor" id="canvasEditor"></div>
                    </div>
                </div>

                <div>
                    <div class="card">
                        <div class="card-title">üñºÔ∏è √ñnizleme ve D√ºzenle</div>
                        <div class="preview-area" id="screenshotPreview" style="min-height: 500px;">
                            <div class="preview-placeholder">
                                Ekran g√∂r√ºnt√ºs√º aldƒ±ƒüƒ±nƒ±zda burada g√∂r√ºnecek
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">üíæ Dƒ±≈üa Aktarma Se√ßenekleri</div>

                        <div class="form-group">
                            <label class="form-label">Format</label>
                            <select id="exportFormat" class="form-control">
                                <option value="png" selected>PNG (Kayƒ±psƒ±z)</option>
                                <option value="jpg">JPG</option>
                                <option value="webp">WebP</option>
                            </select>
                        </div>

                        <div class="form-group" id="jpgQualityGroup" class="hidden">
                            <label class="form-label">JPG Kalitesi: <span class="range-value" id="jpgQualityValue">90%</span></label>
                            <input type="range" id="jpgQuality" class="slider" min="1" max="100" value="90">
                        </div>

                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="downloadScreenshot()">
                                üì• ƒ∞ndir
                            </button>
                            <button class="btn btn-outline" onclick="copyToClipboard()">
                                üìã Panoya Kopyala
                            </button>
                            <button class="btn btn-outline" onclick="printImage()">
                                üñ®Ô∏è Yazdƒ±r
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">üé® Efektler ve Filtreler</div>

                        <div class="form-group">
                            <label class="form-label">Parlaklƒ±k: <span class="range-value" id="brightnessValue">100%</span></label>
                            <input type="range" id="brightness" class="slider" min="0" max="200" value="100">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Kontrast: <span class="range-value" id="contrastValue">100%</span></label>
                            <input type="range" id="contrast" class="slider" min="0" max="200" value="100">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Doygunluk: <span class="range-value" id="saturationValue">100%</span></label>
                            <input type="range" id="saturation" class="slider" min="0" max="200" value="100">
                        </div>

                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 16px;">
                            <button class="btn btn-outline" onclick="applyFilter('grayscale')">‚¨õ Siyah-Beyaz</button>
                            <button class="btn btn-outline" onclick="applyFilter('sepia')">üü§ Sepia</button>
                            <button class="btn btn-outline" onclick="applyFilter('reset')">üîÑ Sƒ±fƒ±rla</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Library Tab -->
        <div id="library-tab" class="tab-content">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <div class="card-title" style="margin-bottom: 0;">üìö Medya K√ºt√ºphanesi</div>
                    <div class="flex gap-2">
                        <button class="btn btn-outline" onclick="refreshLibrary()">üîÑ Yenile</button>
                        <button class="btn btn-danger" onclick="clearAllMedia()">üóëÔ∏è T√ºm√ºn√º Temizle</button>
                    </div>
                </div>

                <div class="search-bar">
                    <input type="text" id="librarySearch" placeholder="Ara..." onkeyup="filterLibrary()">
                    <span class="search-icon">üîç</span>
                </div>

                <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <select id="libraryFilter" class="form-control" style="width: auto;" onchange="filterLibrary()">
                        <option value="all">T√ºm√º</option>
                        <option value="video">Videolar</option>
                        <option value="image">G√∂r√ºnt√ºler</option>
                    </select>
                    <select id="librarySort" class="form-control" style="width: auto;" onchange="sortLibrary()">
                        <option value="date-desc">Tarih (Yeni‚ÜíEski)</option>
                        <option value="date-asc">Tarih (Eski‚ÜíYeni)</option>
                        <option value="name-asc">ƒ∞sim (A‚ÜíZ)</option>
                        <option value="name-desc">ƒ∞sim (Z‚ÜíA)</option>
                        <option value="size-desc">Boyut (B√ºy√ºk‚ÜíK√º√ß√ºk)</option>
                        <option value="size-asc">Boyut (K√º√ß√ºk‚ÜíB√ºy√ºk)</option>
                    </select>
                </div>

                <div id="libraryGrid" class="library-grid">
                    <!-- Media items will be loaded here -->
                </div>

                <div id="libraryEmpty" class="empty-state hidden">
                    <div class="empty-state-icon">üìÇ</div>
                    <div class="empty-state-text">Hen√ºz kayƒ±t veya ekran g√∂r√ºnt√ºs√º yok</div>
                    <button class="btn btn-primary" onclick="switchTab('recording')">ƒ∞lk Kaydƒ±nƒ±zƒ± Yapƒ±n</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Countdown Overlay -->
    <div class="countdown-overlay" id="countdownOverlay">
        <div class="countdown-number" id="countdownNumber">3</div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div id="notificationMessage"></div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content" style="max-width: 800px; width: 90%;">
            <button class="modal-close" onclick="closeSettings()">√ó</button>
            <h2 style="margin-bottom: 24px;">‚öôÔ∏è Ayarlar</h2>

            <div class="settings-section">
                <div class="settings-section-title">üåç Genel</div>

                <div class="form-group">
                    <label class="form-label">Varsayƒ±lan Kayƒ±t Konumu</label>
                    <input type="text" class="form-control" id="defaultSaveLocation" value="ƒ∞ndirilenler" readonly>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="autoSave" checked>
                    <label for="autoSave">Otomatik Kaydet (Konumu Sormadan)</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="showNotifications" checked>
                    <label for="showNotifications">Bildirimleri G√∂ster</label>
                </div>

                <div class="form-group">
                    <label class="form-label">Dosya Adƒ± ≈ûablonu</label>
                    <input type="text" class="form-control" id="filenamePattern" value="kayit_{{timestamp}}">
                    <small style="color: var(--text-secondary);">{{timestamp}} zaman damgasƒ± ile deƒüi≈ütirilir</small>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-section-title">üíæ Depolama</div>

                <div class="form-group">
                    <label class="form-label">Maksimum √ñnbellek Boyutu (MB)</label>
                    <input type="number" class="form-control" id="maxCacheSize" value="1000" min="100" step="100">
                </div>

                <div class="form-group">
                    <label class="form-label">Eski Kayƒ±tlarƒ± Otomatik Sil (G√ºn)</label>
                    <input type="number" class="form-control" id="autoDeleteDays" value="30" min="0">
                    <small style="color: var(--text-secondary);">0 = Otomatik silme yok</small>
                </div>

                <button class="btn btn-warning" onclick="clearCache()">üóëÔ∏è √ñnbelleƒüi Temizle</button>
            </div>

            <div class="settings-section">
                <div class="settings-section-title">üìä ƒ∞statistikler</div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalRecordings">0</div>
                        <div class="stat-label">Toplam Kayƒ±t</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalScreenshots">0</div>
                        <div class="stat-label">Toplam Ekran G√∂r√ºnt√ºs√º</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalStorage">0 MB</div>
                        <div class="stat-label">Kullanƒ±lan Depolama</div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-section-title">üíæ Yedekleme</div>

                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="exportSettings()">üì§ Ayarlarƒ± Dƒ±≈üa Aktar</button>
                    <button class="btn btn-outline" onclick="importSettings()">üì• Ayarlarƒ± ƒ∞√ße Aktar</button>
                </div>
            </div>

            <div style="margin-top: 24px; text-align: right;">
                <button class="btn btn-primary" onclick="saveSettings()">üíæ Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content" style="max-width: 700px; width: 90%;">
            <button class="modal-close" onclick="closeHelp()">√ó</button>
            <h2 style="margin-bottom: 24px;">‚ùì Yardƒ±m ve Rehber</h2>

            <div class="settings-section">
                <div class="settings-section-title">üé• Ekran Kaydƒ± Nasƒ±l Yapƒ±lƒ±r?</div>
                <ol style="line-height: 2; padding-left: 20px;">
                    <li>"Ekran Kaydƒ±" sekmesine gidin</li>
                    <li>Kayƒ±t ayarlarƒ±nƒ±zƒ± yapƒ±landƒ±rƒ±n (√ß√∂z√ºn√ºrl√ºk, FPS, ses vb.)</li>
                    <li>"Kaydƒ± Ba≈ülat" butonuna tƒ±klayƒ±n</li>
                    <li>Kaydetmek istediƒüiniz pencereyi veya ekranƒ± se√ßin</li>
                    <li>Kayƒ±t otomatik olarak ba≈ülayacaktƒ±r</li>
                    <li>ƒ∞≈üiniz bittiƒüinde "Durdur" butonuna tƒ±klayƒ±n</li>
                    <li>Kayƒ±t otomatik olarak indirilecektir</li>
                </ol>
            </div>

            <div class="settings-section">
                <div class="settings-section-title">üì∏ Ekran G√∂r√ºnt√ºs√º Nasƒ±l Alƒ±nƒ±r?</div>
                <ol style="line-height: 2; padding-left: 20px;">
                    <li>"Ekran G√∂r√ºnt√ºs√º" sekmesine gidin</li>
                    <li>Yakalama modunu se√ßin (T√ºm Ekran, Pencere, veya Alan)</li>
                    <li>"Ekran G√∂r√ºnt√ºs√º Al" butonuna tƒ±klayƒ±n</li>
                    <li>Yakalama moduna g√∂re ekran veya alanƒ± se√ßin</li>
                    <li>G√∂r√ºnt√º d√ºzenleme ara√ßlarƒ±yla d√ºzenleyin</li>
                    <li>"ƒ∞ndir" veya "Panoya Kopyala" ile kaydedin</li>
                </ol>
            </div>

            <div class="settings-section">
                <div class="settings-section-title">‚å®Ô∏è Klavye Kƒ±sayollarƒ±</div>
                <div style="line-height: 2.5;">
                    <div><kbd>Ctrl+Shift+R</kbd> - Kaydƒ± Ba≈ülat/Durdur</div>
                    <div><kbd>Ctrl+Shift+P</kbd> - Kaydƒ± Duraklat/Devam Et</div>
                    <div><kbd>Ctrl+Shift+S</kbd> - Ekran G√∂r√ºnt√ºs√º Al</div>
                    <div><kbd>Ctrl+Shift+D</kbd> - √áizim Modunu A√ß/Kapat</div>
                    <div><kbd>Esc</kbd> - ƒ∞ptal Et</div>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-section-title">üåê Tarayƒ±cƒ± Uyumluluƒüu</div>
                <p>Bu uygulama ≈üu tarayƒ±cƒ±larda en iyi ≈üekilde √ßalƒ±≈üƒ±r:</p>
                <ul style="line-height: 2; padding-left: 20px;">
                    <li>Google Chrome 90+</li>
                    <li>Microsoft Edge 90+</li>
                    <li>Firefox 88+</li>
                    <li>Safari 14+ (Sƒ±nƒ±rlƒ± destek)</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Video Player Modal -->
    <div class="modal" id="videoPlayerModal">
        <div class="modal-content" style="max-width: 1200px; width: 95%;">
            <button class="modal-close" onclick="closeVideoPlayer()">√ó</button>
            <h2 style="margin-bottom: 24px;" id="videoPlayerTitle">Video Oynatƒ±cƒ±</h2>

            <div class="video-player">
                <video id="modalVideo" controls style="width: 100%;"></video>
            </div>

            <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="downloadCurrentVideo()">üì• ƒ∞ndir</button>
                <button class="btn btn-outline" onclick="deleteCurrentVideo()">üóëÔ∏è Sil</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let mediaRecorder;
        let recordedChunks = [];
        let recordingStream;
        let webcamStream;
        let recordingStartTime;
        let recordingTimer;
        let currentTab = 'recording';
        let mediaDB;
        let currentScreenshot;
        let editHistory = [];
        let editHistoryIndex = -1;
        let currentTool = null;
        let isDrawing = false;
        let canvasContext;
        let currentCanvas;
        let currentVideoBlob;
        let currentVideoId;
        let drawingCanvas;
        let drawingContext;
        let lastX = 0;
        let lastY = 0;
        let compositeCanvas;
        let compositeContext;
        let webcamVideo;

        // Live drawing mode variables
        let isDrawingModeActive = false;
        let liveDrawingCanvas;
        let liveDrawingContext;
        let liveDrawingTool = 'pen';
        let liveDrawingColor = '#FF0000';
        let liveDrawingSize = 3;
        let isLiveDrawing = false;
        let liveLastX = 0;
        let liveLastY = 0;

        // IndexedDB Setup
        function initDB() {
            const request = indexedDB.open('ScreenCaptureDB', 1);

            request.onerror = () => {
                showNotification('Veritabanƒ± hatasƒ± olu≈ütu', 'error');
            };

            request.onsuccess = (event) => {
                mediaDB = event.target.result;
                loadLibrary();
                updateStats();
            };

            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains('media')) {
                    const objectStore = db.createObjectStore('media', { keyPath: 'id', autoIncrement: true });
                    objectStore.createIndex('type', 'type', { unique: false });
                    objectStore.createIndex('date', 'date', { unique: false });
                    objectStore.createIndex('name', 'name', { unique: false });
                }
            };
        }

        // Theme Toggle
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
        }

        // Tab Switching
        function switchTab(tab) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

            // Show selected tab
            document.getElementById(`${tab}-tab`).classList.add('active');
            event.target.classList.add('active');

            currentTab = tab;

            if (tab === 'library') {
                loadLibrary();
            }
        }

        // Notifications
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const messageEl = document.getElementById('notificationMessage');

            messageEl.textContent = message;
            notification.className = `notification ${type} active`;

            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }

        // Area Selection
        let selectedArea = null;

        async function showAreaSelector(displayStream, videoSettings) {
            return new Promise((resolve) => {
                // Get video dimensions
                const videoWidth = videoSettings.width || 1920;
                const videoHeight = videoSettings.height || 1080;

                // Create fullscreen overlay
                const overlay = document.createElement('div');
                overlay.style.position = 'fixed';
                overlay.style.top = '0';
                overlay.style.left = '0';
                overlay.style.width = '100%';
                overlay.style.height = '100%';
                overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.95)';
                overlay.style.zIndex = '10000';
                overlay.style.display = 'flex';
                overlay.style.flexDirection = 'column';
                overlay.style.alignItems = 'center';
                overlay.style.justifyContent = 'center';
                overlay.style.padding = '20px';

                const instruction = document.createElement('div');
                instruction.innerHTML = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 22px; font-weight: bold; color: white; margin-bottom: 10px;">
                            üì∫ A≈üaƒüƒ±daki √∂nizleme √ºzerinde fareyle dikd√∂rtgen √ßizerek kaydetmek istediƒüiniz alanƒ± se√ßin
                        </div>
                        <div style="font-size: 16px; color: #FFD700;">
                            ‚ö†Ô∏è Bu √∂nizleme se√ßtiƒüiniz ekran/sekme/pencereyi g√∂steriyor ‚Ä¢ ESC ile iptal
                        </div>
                    </div>
                `;
                instruction.style.zIndex = '10002';
                overlay.appendChild(instruction);

                // Create video container with border
                const videoContainer = document.createElement('div');
                videoContainer.style.position = 'relative';
                videoContainer.style.maxWidth = '95%';
                videoContainer.style.maxHeight = 'calc(100vh - 150px)';
                videoContainer.style.border = '4px solid #2196F3';
                videoContainer.style.borderRadius = '8px';
                videoContainer.style.overflow = 'hidden';
                videoContainer.style.backgroundColor = '#000';
                videoContainer.style.boxShadow = '0 0 30px rgba(33, 150, 243, 0.5)';

                // Create video preview element
                const previewVideo = document.createElement('video');
                previewVideo.srcObject = displayStream;
                previewVideo.style.width = '100%';
                previewVideo.style.height = '100%';
                previewVideo.style.display = 'block';
                previewVideo.style.cursor = 'crosshair';
                previewVideo.muted = true;
                previewVideo.autoplay = true;
                previewVideo.play();
                videoContainer.appendChild(previewVideo);

                overlay.appendChild(videoContainer);

                let selectionBox = null;
                let startX, startY;
                let isSelecting = false;

                // Wait for video to load
                previewVideo.onloadedmetadata = () => {
                    previewVideo.play();
                };

                videoContainer.addEventListener('mousedown', (e) => {
                    e.stopPropagation();
                    isSelecting = true;

                    const rect = videoContainer.getBoundingClientRect();
                    startX = e.clientX - rect.left;
                    startY = e.clientY - rect.top;

                    if (selectionBox) {
                        selectionBox.remove();
                    }

                    selectionBox = document.createElement('div');
                    selectionBox.style.position = 'absolute';
                    selectionBox.style.border = '3px dashed #FFD700';
                    selectionBox.style.backgroundColor = 'rgba(255, 215, 0, 0.2)';
                    selectionBox.style.left = startX + 'px';
                    selectionBox.style.top = startY + 'px';
                    selectionBox.style.zIndex = '10001';
                    selectionBox.style.pointerEvents = 'none';
                    videoContainer.appendChild(selectionBox);
                });

                videoContainer.addEventListener('mousemove', (e) => {
                    if (!isSelecting || !selectionBox) return;
                    e.stopPropagation();

                    const rect = videoContainer.getBoundingClientRect();
                    const currentX = e.clientX - rect.left;
                    const currentY = e.clientY - rect.top;

                    const width = currentX - startX;
                    const height = currentY - startY;

                    if (width > 0) {
                        selectionBox.style.width = width + 'px';
                        selectionBox.style.left = startX + 'px';
                    } else {
                        selectionBox.style.width = Math.abs(width) + 'px';
                        selectionBox.style.left = currentX + 'px';
                    }

                    if (height > 0) {
                        selectionBox.style.height = height + 'px';
                        selectionBox.style.top = startY + 'px';
                    } else {
                        selectionBox.style.height = Math.abs(height) + 'px';
                        selectionBox.style.top = currentY + 'px';
                    }
                });

                videoContainer.addEventListener('mouseup', (e) => {
                    if (!isSelecting || !selectionBox) return;
                    e.stopPropagation();

                    isSelecting = false;

                    const rect = videoContainer.getBoundingClientRect();
                    const currentX = e.clientX - rect.left;
                    const currentY = e.clientY - rect.top;

                    const screenX = Math.min(startX, currentX);
                    const screenY = Math.min(startY, currentY);
                    const screenW = Math.abs(currentX - startX);
                    const screenH = Math.abs(currentY - startY);

                    if (screenW > 20 && screenH > 20) {
                        // Video container size to video stream size ratio
                        const containerWidth = rect.width;
                        const containerHeight = rect.height;
                        const videoScaleX = videoWidth / containerWidth;
                        const videoScaleY = videoHeight / containerHeight;

                        // Convert container coordinates to video coordinates
                        const videoX = Math.round(screenX * videoScaleX);
                        const videoY = Math.round(screenY * videoScaleY);
                        const videoW = Math.round(screenW * videoScaleX);
                        const videoH = Math.round(screenH * videoScaleY);

                        // Ensure coordinates are within bounds
                        const finalX = Math.max(0, Math.min(videoX, videoWidth));
                        const finalY = Math.max(0, Math.min(videoY, videoHeight));
                        const finalW = Math.min(videoW, videoWidth - finalX);
                        const finalH = Math.min(videoH, videoHeight - finalY);

                        // Store video coordinates
                        selectedArea = {
                            x: finalX,
                            y: finalY,
                            width: finalW,
                            height: finalH
                        };

                        previewVideo.srcObject = null;
                        overlay.remove();
                        document.removeEventListener('keydown', escHandler);
                        resolve(selectedArea);
                    } else {
                        showNotification('L√ºtfen daha b√ºy√ºk bir alan se√ßin', 'warning');
                        if (selectionBox) {
                            selectionBox.remove();
                            selectionBox = null;
                        }
                    }
                });

                // ESC to cancel
                const escHandler = (e) => {
                    if (e.key === 'Escape') {
                        previewVideo.srcObject = null;
                        overlay.remove();
                        document.removeEventListener('keydown', escHandler);
                        resolve(null);
                    }
                };
                document.addEventListener('keydown', escHandler);

                document.body.appendChild(overlay);
            });
        }

        // Recording Functions
        async function startRecording() {
            try {
                const useCountdown = document.getElementById('countdown').checked;

                if (useCountdown) {
                    await showCountdown();
                }

                const mode = document.getElementById('recordingMode').value;
                const systemAudio = document.getElementById('systemAudio').checked;
                const micAudio = document.getElementById('microphoneAudio').checked;

                // Get display media
                const displayConstraints = {
                    video: {
                        displaySurface: mode === 'window' ? 'window' : mode === 'tab' ? 'browser' : mode === 'area' ? 'monitor' : 'monitor',
                        cursor: 'always'
                    },
                    audio: systemAudio
                };

                const displayStream = await navigator.mediaDevices.getDisplayMedia(displayConstraints);

                // Get video settings
                const videoTrack = displayStream.getVideoTracks()[0];
                const videoSettings = videoTrack.getSettings();

                // If area mode, show area selector
                if (mode === 'area') {
                    const area = await showAreaSelector(displayStream, videoSettings);
                    if (!area) {
                        // User cancelled
                        displayStream.getTracks().forEach(track => track.stop());
                        showNotification('Alan se√ßimi iptal edildi', 'info');
                        return;
                    }
                    selectedArea = area;
                }

                // Setup webcam if enabled
                const webcamEnabled = document.getElementById('webcamEnabled').checked;

                if (webcamEnabled) {
                    webcamStream = await navigator.mediaDevices.getUserMedia({ video: true });
                }

                // Always create composite canvas (for webcam, area selection, or drawing mode)
                compositeCanvas = document.createElement('canvas');
                compositeContext = compositeCanvas.getContext('2d');

                // Set canvas size based on area selection or full screen
                if (mode === 'area' && selectedArea) {
                    compositeCanvas.width = selectedArea.width;
                    compositeCanvas.height = selectedArea.height;
                } else {
                    compositeCanvas.width = videoSettings.width || 1920;
                    compositeCanvas.height = videoSettings.height || 1080;
                }

                // Create video element for display stream
                const displayVideo = document.createElement('video');
                displayVideo.srcObject = displayStream;
                displayVideo.muted = true;
                displayVideo.play();

                // Create video element for webcam if enabled
                if (webcamEnabled) {
                    webcamVideo = document.createElement('video');
                    webcamVideo.srcObject = webcamStream;
                    webcamVideo.muted = true;
                    webcamVideo.play();
                }

                // Get webcam settings
                let webcamSize, webcamX, webcamY, webcamShape;
                if (webcamEnabled) {
                    webcamSize = parseInt(document.getElementById('webcamSize').value);
                    const webcamPosition = document.getElementById('webcamPosition').value;
                    webcamShape = document.getElementById('webcamShape').value;

                    // Calculate webcam position
                    const padding = 20;

                    switch (webcamPosition) {
                        case 'top-left':
                            webcamX = padding;
                            webcamY = padding;
                            break;
                        case 'top-right':
                            webcamX = compositeCanvas.width - webcamSize - padding;
                            webcamY = padding;
                            break;
                        case 'bottom-left':
                            webcamX = padding;
                            webcamY = compositeCanvas.height - webcamSize - padding;
                            break;
                        case 'bottom-right':
                        default:
                            webcamX = compositeCanvas.width - webcamSize - padding;
                            webcamY = compositeCanvas.height - webcamSize - padding;
                            break;
                    }
                }

                // Store selected area locally to avoid issues with closure
                const cropArea = mode === 'area' && selectedArea ? { ...selectedArea } : null;

                // Composite the streams
                function drawComposite() {
                    if (!compositeCanvas) return;

                    // Draw display stream (crop to selected area if needed)
                    if (cropArea) {
                        // Crop the video to the selected area
                        compositeContext.drawImage(
                            displayVideo,
                            cropArea.x, cropArea.y, cropArea.width, cropArea.height,
                            0, 0, compositeCanvas.width, compositeCanvas.height
                        );
                    } else {
                        // Draw full screen
                        compositeContext.drawImage(displayVideo, 0, 0, compositeCanvas.width, compositeCanvas.height);
                    }

                    // Draw webcam overlay if enabled
                    if (webcamEnabled && webcamVideo) {
                        compositeContext.save();

                        if (webcamShape === 'circle') {
                            compositeContext.beginPath();
                            compositeContext.arc(webcamX + webcamSize / 2, webcamY + webcamSize / 2, webcamSize / 2, 0, Math.PI * 2);
                            compositeContext.closePath();
                            compositeContext.clip();
                        } else if (webcamShape === 'rounded') {
                            const radius = 12;
                            compositeContext.beginPath();
                            compositeContext.roundRect(webcamX, webcamY, webcamSize, webcamSize, radius);
                            compositeContext.closePath();
                            compositeContext.clip();
                        }

                        compositeContext.drawImage(webcamVideo, webcamX, webcamY, webcamSize, webcamSize);
                        compositeContext.restore();

                        // Draw border
                        compositeContext.strokeStyle = 'white';
                        compositeContext.lineWidth = 3;
                        if (webcamShape === 'circle') {
                            compositeContext.beginPath();
                            compositeContext.arc(webcamX + webcamSize / 2, webcamY + webcamSize / 2, webcamSize / 2, 0, Math.PI * 2);
                            compositeContext.stroke();
                        } else if (webcamShape === 'rounded') {
                            compositeContext.beginPath();
                            compositeContext.roundRect(webcamX, webcamY, webcamSize, webcamSize, 12);
                            compositeContext.stroke();
                        } else {
                            compositeContext.strokeRect(webcamX, webcamY, webcamSize, webcamSize);
                        }
                    }

                    // Draw live drawing overlay if drawing mode is active
                    if (isDrawingModeActive && liveDrawingCanvas) {
                        compositeContext.drawImage(liveDrawingCanvas, 0, 0, compositeCanvas.width, compositeCanvas.height);
                    }

                    requestAnimationFrame(drawComposite);
                }

                await new Promise(resolve => {
                    displayVideo.onloadedmetadata = () => {
                        if (webcamEnabled && webcamVideo) {
                            webcamVideo.onloadedmetadata = resolve;
                        } else {
                            resolve();
                        }
                    };
                });

                drawComposite();

                // Get stream from composite canvas
                const compositeStream = compositeCanvas.captureStream(30);
                recordingStream = new MediaStream([...compositeStream.getVideoTracks(), ...displayStream.getAudioTracks()]);

                // Reset selectedArea after starting recording
                selectedArea = null;

                // Add microphone if needed
                if (micAudio) {
                    const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    audioStream.getAudioTracks().forEach(track => {
                        recordingStream.addTrack(track);
                    });
                }

                // Setup MediaRecorder
                const options = {
                    mimeType: 'video/webm;codecs=vp9',
                    videoBitsPerSecond: document.getElementById('bitrate').value * 1000000
                };

                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options.mimeType = 'video/webm';
                }

                mediaRecorder = new MediaRecorder(recordingStream, options);
                recordedChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = saveRecording;

                mediaRecorder.start(1000); // Collect data every second

                // Update UI
                document.getElementById('startRecordingBtn').classList.add('hidden');
                document.getElementById('pauseRecordingBtn').classList.remove('hidden');
                document.getElementById('stopRecordingBtn').classList.remove('hidden');
                document.getElementById('recordingIndicator').classList.remove('hidden');

                // Show preview
                const previewVideo = document.getElementById('previewVideo');
                if (needsComposite && compositeCanvas) {
                    previewVideo.srcObject = compositeCanvas.captureStream(30);
                } else {
                    previewVideo.srcObject = recordingStream;
                }
                previewVideo.classList.remove('hidden');
                previewVideo.play();
                document.getElementById('previewPlaceholder').classList.add('hidden');

                // Start timer
                recordingStartTime = Date.now();
                startRecordingTimerUpdate();

                // Auto-stop timer
                const autoStopMinutes = parseInt(document.getElementById('autoStop').value);
                if (autoStopMinutes > 0) {
                    setTimeout(() => {
                        if (mediaRecorder && mediaRecorder.state === 'recording') {
                            stopRecording();
                        }
                    }, autoStopMinutes * 60 * 1000);
                }

                showNotification('Kayƒ±t ba≈ülatƒ±ldƒ±!', 'success');
            } catch (error) {
                console.error('Recording error:', error);
                showNotification('Kayƒ±t ba≈ülatƒ±lamadƒ±: ' + error.message, 'error');
            }
        }

        function pauseRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.pause();
                document.getElementById('pauseRecordingBtn').innerHTML = '‚ñ∂Ô∏è Devam Et';
                showNotification('Kayƒ±t duraklatƒ±ldƒ±', 'warning');
            } else if (mediaRecorder && mediaRecorder.state === 'paused') {
                mediaRecorder.resume();
                document.getElementById('pauseRecordingBtn').innerHTML = '‚è∏Ô∏è Duraklat';
                showNotification('Kayƒ±t devam ediyor', 'success');
            }
        }

        function stopRecording() {
            if (mediaRecorder) {
                mediaRecorder.stop();

                if (recordingStream) {
                    recordingStream.getTracks().forEach(track => track.stop());
                }

                if (webcamStream) {
                    webcamStream.getTracks().forEach(track => track.stop());
                    webcamStream = null;
                }

                // Clean up composite canvas
                if (compositeCanvas) {
                    compositeContext = null;
                    compositeCanvas = null;
                }

                if (webcamVideo) {
                    webcamVideo.srcObject = null;
                    webcamVideo = null;
                }

                // Clean up drawing mode
                if (isDrawingModeActive) {
                    isDrawingModeActive = false;
                    const existingCanvas = document.getElementById('liveDrawingCanvas');
                    if (existingCanvas) {
                        existingCanvas.remove();
                    }
                    hideLiveDrawingToolbar();
                    liveDrawingCanvas = null;
                    liveDrawingContext = null;
                }

                // Update UI
                document.getElementById('startRecordingBtn').classList.remove('hidden');
                document.getElementById('pauseRecordingBtn').classList.add('hidden');
                document.getElementById('stopRecordingBtn').classList.add('hidden');
                document.getElementById('recordingIndicator').classList.add('hidden');

                const previewVideo = document.getElementById('previewVideo');
                previewVideo.srcObject = null;
                previewVideo.classList.add('hidden');
                document.getElementById('previewPlaceholder').classList.remove('hidden');

                clearInterval(recordingTimer);
                document.getElementById('recordingTimer').textContent = '00:00:00';
                document.getElementById('recordingSize').textContent = 'Tahmini Boyut: 0 MB';

                showNotification('Kayƒ±t durduruldu', 'info');
            }
        }

        function saveRecording() {
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            const url = URL.createObjectURL(blob);

            // Generate filename
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const pattern = document.getElementById('filenamePattern')?.value || 'kayit_{{timestamp}}';
            const filename = pattern.replace('{{timestamp}}', timestamp) + '.webm';

            // Save to IndexedDB
            saveToLibrary(blob, filename, 'video');

            // Download
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();

            showNotification('Kayƒ±t kaydedildi!', 'success');
            updateStats();
        }

        function startRecordingTimerUpdate() {
            recordingTimer = setInterval(() => {
                const elapsed = Date.now() - recordingStartTime;
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);

                document.getElementById('recordingTimer').textContent =
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

                // Estimate file size (very rough estimate)
                const bitrate = document.getElementById('bitrate').value;
                const estimatedMB = (elapsed / 1000) * (bitrate / 8);
                document.getElementById('recordingSize').textContent = `Tahmini Boyut: ${estimatedMB.toFixed(2)} MB`;
            }, 1000);
        }

        async function showCountdown() {
            const overlay = document.getElementById('countdownOverlay');
            const numberEl = document.getElementById('countdownNumber');

            overlay.classList.add('active');

            for (let i = 3; i >= 1; i--) {
                numberEl.textContent = i;
                numberEl.style.animation = 'none';
                setTimeout(() => numberEl.style.animation = 'countdownPulse 1s', 10);
                await new Promise(resolve => setTimeout(resolve, 1000));
            }

            overlay.classList.remove('active');
        }

        // Screenshot Functions
        async function takeScreenshot() {
            try {
                const mode = document.getElementById('screenshotMode').value;
                const delay = parseInt(document.getElementById('screenshotDelay').value);

                if (delay > 0) {
                    showNotification(`${delay} saniye i√ßinde ekran g√∂r√ºnt√ºs√º alƒ±nacak...`, 'info');
                    await new Promise(resolve => setTimeout(resolve, delay * 1000));
                }

                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { mediaSource: 'screen' }
                });

                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();

                await new Promise(resolve => {
                    video.onloadedmetadata = resolve;
                });

                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;

                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0);

                stream.getTracks().forEach(track => track.stop());

                currentScreenshot = canvas;
                displayScreenshot(canvas);

                if (document.getElementById('autoCopyClipboard').checked) {
                    copyToClipboard();
                }

                showNotification('Ekran g√∂r√ºnt√ºs√º alƒ±ndƒ±!', 'success');
            } catch (error) {
                console.error('Screenshot error:', error);
                showNotification('Ekran g√∂r√ºnt√ºs√º alƒ±namadƒ±: ' + error.message, 'error');
            }
        }

        function displayScreenshot(canvas) {
            const preview = document.getElementById('screenshotPreview');
            preview.innerHTML = '';

            // Create container for image and drawing canvas
            const container = document.createElement('div');
            container.style.position = 'relative';
            container.style.display = 'inline-block';

            const img = document.createElement('img');
            img.src = canvas.toDataURL();
            img.style.maxWidth = '100%';
            img.style.height = 'auto';
            img.style.display = 'block';
            container.appendChild(img);

            // Create drawing canvas overlay
            drawingCanvas = document.createElement('canvas');
            drawingCanvas.width = canvas.width;
            drawingCanvas.height = canvas.height;
            drawingCanvas.style.position = 'absolute';
            drawingCanvas.style.top = '0';
            drawingCanvas.style.left = '0';
            drawingCanvas.style.maxWidth = '100%';
            drawingCanvas.style.height = 'auto';
            drawingCanvas.style.cursor = 'crosshair';
            container.appendChild(drawingCanvas);

            preview.appendChild(container);

            drawingContext = drawingCanvas.getContext('2d');

            // Setup drawing events
            drawingCanvas.addEventListener('mousedown', startDrawing);
            drawingCanvas.addEventListener('mousemove', draw);
            drawingCanvas.addEventListener('mouseup', stopDrawing);
            drawingCanvas.addEventListener('mouseout', stopDrawing);

            // Show editing toolbar
            document.getElementById('editingToolbar').classList.remove('hidden');

            // Initialize editing
            editHistory = [canvas.toDataURL()];
            editHistoryIndex = 0;
        }

        function startDrawing(e) {
            if (!currentTool) return;

            isDrawing = true;
            const rect = drawingCanvas.getBoundingClientRect();
            const scaleX = drawingCanvas.width / rect.width;
            const scaleY = drawingCanvas.height / rect.height;

            lastX = (e.clientX - rect.left) * scaleX;
            lastY = (e.clientY - rect.top) * scaleY;
        }

        function draw(e) {
            if (!isDrawing || !currentTool) return;

            const rect = drawingCanvas.getBoundingClientRect();
            const scaleX = drawingCanvas.width / rect.width;
            const scaleY = drawingCanvas.height / rect.height;

            const currentX = (e.clientX - rect.left) * scaleX;
            const currentY = (e.clientY - rect.top) * scaleY;

            const color = document.getElementById('drawColor').value;
            const size = document.getElementById('drawSize').value;

            drawingContext.strokeStyle = color;
            drawingContext.fillStyle = color;
            drawingContext.lineWidth = size;
            drawingContext.lineCap = 'round';
            drawingContext.lineJoin = 'round';

            if (currentTool === 'pen') {
                drawingContext.beginPath();
                drawingContext.moveTo(lastX, lastY);
                drawingContext.lineTo(currentX, currentY);
                drawingContext.stroke();
                lastX = currentX;
                lastY = currentY;
            } else if (currentTool === 'highlighter') {
                drawingContext.globalAlpha = 0.3;
                drawingContext.lineWidth = size * 3;
                drawingContext.beginPath();
                drawingContext.moveTo(lastX, lastY);
                drawingContext.lineTo(currentX, currentY);
                drawingContext.stroke();
                drawingContext.globalAlpha = 1.0;
                lastX = currentX;
                lastY = currentY;
            } else if (currentTool === 'rectangle' || currentTool === 'circle' || currentTool === 'arrow') {
                // For shapes, we need to clear and redraw on mouse move
                // Store the shape start point and update on mouse up
                e.currentTarget._shapeEndX = currentX;
                e.currentTarget._shapeEndY = currentY;
            } else if (currentTool === 'text') {
                // Text will be handled on click
            } else if (currentTool === 'blur') {
                // Apply blur effect in a circular area
                const blurRadius = size * 2;
                const imageData = drawingContext.getImageData(
                    Math.max(0, currentX - blurRadius),
                    Math.max(0, currentY - blurRadius),
                    blurRadius * 2,
                    blurRadius * 2
                );
                // Simple pixelation effect
                const pixelSize = 8;
                for (let y = 0; y < imageData.height; y += pixelSize) {
                    for (let x = 0; x < imageData.width; x += pixelSize) {
                        const pixelIndex = (y * imageData.width + x) * 4;
                        const r = imageData.data[pixelIndex];
                        const g = imageData.data[pixelIndex + 1];
                        const b = imageData.data[pixelIndex + 2];

                        for (let py = 0; py < pixelSize && y + py < imageData.height; py++) {
                            for (let px = 0; px < pixelSize && x + px < imageData.width; px++) {
                                const index = ((y + py) * imageData.width + (x + px)) * 4;
                                imageData.data[index] = r;
                                imageData.data[index + 1] = g;
                                imageData.data[index + 2] = b;
                            }
                        }
                    }
                }
                drawingContext.putImageData(
                    imageData,
                    Math.max(0, currentX - blurRadius),
                    Math.max(0, currentY - blurRadius)
                );
                lastX = currentX;
                lastY = currentY;
            }
        }

        function stopDrawing(e) {
            if (isDrawing && currentTool) {
                // Draw shapes on mouse up
                if (currentTool === 'rectangle' && e && e.currentTarget._shapeEndX) {
                    const color = document.getElementById('drawColor').value;
                    const size = document.getElementById('drawSize').value;

                    drawingContext.strokeStyle = color;
                    drawingContext.lineWidth = size;

                    const width = e.currentTarget._shapeEndX - lastX;
                    const height = e.currentTarget._shapeEndY - lastY;
                    drawingContext.strokeRect(lastX, lastY, width, height);

                    delete e.currentTarget._shapeEndX;
                    delete e.currentTarget._shapeEndY;
                } else if (currentTool === 'circle' && e && e.currentTarget._shapeEndX) {
                    const color = document.getElementById('drawColor').value;
                    const size = document.getElementById('drawSize').value;

                    drawingContext.strokeStyle = color;
                    drawingContext.lineWidth = size;

                    const radius = Math.sqrt(
                        Math.pow(e.currentTarget._shapeEndX - lastX, 2) +
                        Math.pow(e.currentTarget._shapeEndY - lastY, 2)
                    );
                    drawingContext.beginPath();
                    drawingContext.arc(lastX, lastY, radius, 0, Math.PI * 2);
                    drawingContext.stroke();

                    delete e.currentTarget._shapeEndX;
                    delete e.currentTarget._shapeEndY;
                } else if (currentTool === 'arrow' && e && e.currentTarget._shapeEndX) {
                    const color = document.getElementById('drawColor').value;
                    const size = document.getElementById('drawSize').value;

                    drawingContext.strokeStyle = color;
                    drawingContext.fillStyle = color;
                    drawingContext.lineWidth = size;

                    const endX = e.currentTarget._shapeEndX;
                    const endY = e.currentTarget._shapeEndY;

                    // Draw line
                    drawingContext.beginPath();
                    drawingContext.moveTo(lastX, lastY);
                    drawingContext.lineTo(endX, endY);
                    drawingContext.stroke();

                    // Draw arrowhead
                    const angle = Math.atan2(endY - lastY, endX - lastX);
                    const arrowLength = 20;

                    drawingContext.beginPath();
                    drawingContext.moveTo(endX, endY);
                    drawingContext.lineTo(
                        endX - arrowLength * Math.cos(angle - Math.PI / 6),
                        endY - arrowLength * Math.sin(angle - Math.PI / 6)
                    );
                    drawingContext.lineTo(
                        endX - arrowLength * Math.cos(angle + Math.PI / 6),
                        endY - arrowLength * Math.sin(angle + Math.PI / 6)
                    );
                    drawingContext.closePath();
                    drawingContext.fill();

                    delete e.currentTarget._shapeEndX;
                    delete e.currentTarget._shapeEndY;
                } else if (currentTool === 'text' && e) {
                    const text = prompt('Metin girin:');
                    if (text) {
                        const color = document.getElementById('drawColor').value;
                        const size = document.getElementById('drawSize').value;

                        drawingContext.fillStyle = color;
                        drawingContext.font = `${size * 5}px Arial`;
                        drawingContext.fillText(text, lastX, lastY);
                    }
                }

                isDrawing = false;

                // Save to history
                mergeDrawingToScreenshot();
            }
        }

        function mergeDrawingToScreenshot() {
            if (!currentScreenshot || !drawingCanvas) return;

            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = currentScreenshot.width;
            tempCanvas.height = currentScreenshot.height;
            const tempCtx = tempCanvas.getContext('2d');

            // Draw original image
            tempCtx.drawImage(currentScreenshot, 0, 0);

            // Draw annotations on top
            tempCtx.drawImage(drawingCanvas, 0, 0);

            // Update current screenshot
            currentScreenshot = tempCanvas;

            // Clear drawing canvas
            drawingContext.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);

            // Add to history
            if (editHistoryIndex < editHistory.length - 1) {
                editHistory = editHistory.slice(0, editHistoryIndex + 1);
            }
            editHistory.push(tempCanvas.toDataURL());
            editHistoryIndex++;
        }

        function activateTool(tool) {
            currentTool = tool;

            const toolNames = {
                'crop': '‚úÇÔ∏è Kƒ±rp',
                'pen': '‚úèÔ∏è Kalem',
                'highlighter': 'üñçÔ∏è Vurgulayƒ±cƒ±',
                'arrow': '‚û°Ô∏è Ok',
                'rectangle': '‚ñ≠ Dikd√∂rtgen',
                'circle': '‚≠ï Daire',
                'text': 'T Metin',
                'blur': 'üå´Ô∏è Bulanƒ±kla≈ütƒ±r'
            };

            showNotification(`${toolNames[tool] || tool} aracƒ± se√ßildi`, 'info');

            // Change cursor based on tool
            if (drawingCanvas) {
                if (tool === 'text') {
                    drawingCanvas.style.cursor = 'text';
                } else if (tool === 'crop') {
                    drawingCanvas.style.cursor = 'crosshair';
                } else {
                    drawingCanvas.style.cursor = 'crosshair';
                }
            }
        }

        function undo() {
            if (editHistoryIndex > 0) {
                editHistoryIndex--;
                restoreFromHistory();
            }
        }

        function redo() {
            if (editHistoryIndex < editHistory.length - 1) {
                editHistoryIndex++;
                restoreFromHistory();
            }
        }

        function restoreFromHistory() {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                currentScreenshot = canvas;
                displayScreenshot(canvas);
            };
            img.src = editHistory[editHistoryIndex];
        }

        function resetCanvas() {
            if (editHistory.length > 0) {
                editHistoryIndex = 0;
                restoreFromHistory();
            }
        }

        function applyFilter(filter) {
            if (!currentScreenshot) return;

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = currentScreenshot.width;
            canvas.height = currentScreenshot.height;

            if (filter === 'reset') {
                document.getElementById('brightness').value = 100;
                document.getElementById('contrast').value = 100;
                document.getElementById('saturation').value = 100;
                updateFilterDisplay();
            }

            const brightness = document.getElementById('brightness').value;
            const contrast = document.getElementById('contrast').value;
            const saturation = document.getElementById('saturation').value;

            let filterString = `brightness(${brightness}%) contrast(${contrast}%) saturate(${saturation}%)`;

            if (filter === 'grayscale') {
                filterString += ' grayscale(100%)';
            } else if (filter === 'sepia') {
                filterString += ' sepia(100%)';
            }

            ctx.filter = filterString;
            ctx.drawImage(currentScreenshot, 0, 0);
            ctx.filter = 'none';

            currentScreenshot = canvas;
            displayScreenshot(canvas);
        }

        function downloadScreenshot() {
            if (!currentScreenshot) {
                showNotification('ƒ∞ndirilecek g√∂r√ºnt√º yok', 'warning');
                return;
            }

            const format = document.getElementById('exportFormat').value;
            let mimeType = 'image/png';
            let extension = 'png';
            let quality = 1;

            if (format === 'jpg') {
                mimeType = 'image/jpeg';
                extension = 'jpg';
                quality = document.getElementById('jpgQuality').value / 100;
            } else if (format === 'webp') {
                mimeType = 'image/webp';
                extension = 'webp';
                quality = 0.9;
            }

            const dataUrl = currentScreenshot.toDataURL(mimeType, quality);

            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const pattern = document.getElementById('filenamePattern')?.value || 'ekrangoruntusu_{{timestamp}}';
            const filename = pattern.replace('{{timestamp}}', timestamp) + '.' + extension;

            const a = document.createElement('a');
            a.href = dataUrl;
            a.download = filename;
            a.click();

            // Convert dataURL to blob and save to library
            fetch(dataUrl)
                .then(res => res.blob())
                .then(blob => {
                    saveToLibrary(blob, filename, 'image');
                    showNotification('Ekran g√∂r√ºnt√ºs√º indirildi!', 'success');
                    updateStats();
                });
        }

        async function copyToClipboard() {
            if (!currentScreenshot) {
                showNotification('Panoya kopyalanacak g√∂r√ºnt√º yok', 'warning');
                return;
            }

            try {
                const blob = await new Promise(resolve => currentScreenshot.toBlob(resolve));
                await navigator.clipboard.write([
                    new ClipboardItem({ 'image/png': blob })
                ]);
                showNotification('Panoya kopyalandƒ±!', 'success');
            } catch (error) {
                showNotification('Panoya kopyalanamadƒ±: ' + error.message, 'error');
            }
        }

        function printImage() {
            if (!currentScreenshot) {
                showNotification('Yazdƒ±rƒ±lacak g√∂r√ºnt√º yok', 'warning');
                return;
            }

            const printWindow = window.open('', '_blank');
            printWindow.document.write('<img src="' + currentScreenshot.toDataURL() + '" onload="window.print();window.close()">');
        }

        function saveEditedImage() {
            downloadScreenshot();
        }

        // Library Functions
        function saveToLibrary(blob, filename, type) {
            if (!mediaDB) return;

            const transaction = mediaDB.transaction(['media'], 'readwrite');
            const objectStore = transaction.objectStore('media');

            const mediaItem = {
                name: filename,
                type: type,
                blob: blob,
                size: blob.size,
                date: new Date().toISOString(),
                duration: type === 'video' ? 0 : null // Would need to calculate for video
            };

            objectStore.add(mediaItem);

            transaction.oncomplete = () => {
                console.log('Media saved to library');
                loadLibrary();
            };

            transaction.onerror = (event) => {
                console.error('Error saving to library:', event);
            };
        }

        function loadLibrary() {
            if (!mediaDB) return;

            const transaction = mediaDB.transaction(['media'], 'readonly');
            const objectStore = transaction.objectStore('media');
            const request = objectStore.getAll();

            request.onsuccess = (event) => {
                const items = event.target.result;
                displayLibraryItems(items);
            };
        }

        function displayLibraryItems(items) {
            const grid = document.getElementById('libraryGrid');
            const empty = document.getElementById('libraryEmpty');

            if (items.length === 0) {
                grid.classList.add('hidden');
                empty.classList.remove('hidden');
                return;
            }

            grid.classList.remove('hidden');
            empty.classList.add('hidden');
            grid.innerHTML = '';

            items.forEach(item => {
                const itemEl = createLibraryItem(item);
                grid.appendChild(itemEl);
            });
        }

        function createLibraryItem(item) {
            const div = document.createElement('div');
            div.className = 'library-item';

            const url = URL.createObjectURL(item.blob);
            const isVideo = item.type === 'video';

            div.innerHTML = `
                <div class="library-thumbnail">
                    ${isVideo ?
                        `<video src="${url}"></video><div class="library-play-icon">‚ñ∂Ô∏è</div>` :
                        `<img src="${url}" alt="${item.name}">`
                    }
                </div>
                <div class="library-info">
                    <div class="library-title">${item.name}</div>
                    <div class="library-meta">
                        <span>${formatFileSize(item.size)}</span>
                        <span>${formatDate(item.date)}</span>
                    </div>
                </div>
                <div class="library-actions">
                    <button onclick="downloadMedia(${item.id})">üì•</button>
                    <button onclick="${isVideo ? `playVideo(${item.id})` : `viewImage(${item.id})`}">üëÅÔ∏è</button>
                    <button onclick="deleteMedia(${item.id})">üóëÔ∏è</button>
                </div>
            `;

            return div;
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        function downloadMedia(id) {
            const transaction = mediaDB.transaction(['media'], 'readonly');
            const objectStore = transaction.objectStore('media');
            const request = objectStore.get(id);

            request.onsuccess = (event) => {
                const item = event.target.result;
                const url = URL.createObjectURL(item.blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = item.name;
                a.click();
                showNotification('ƒ∞ndirme ba≈ülatƒ±ldƒ±', 'success');
            };
        }

        function deleteMedia(id) {
            if (!confirm('Bu medyayƒ± silmek istediƒüinizden emin misiniz?')) return;

            const transaction = mediaDB.transaction(['media'], 'readwrite');
            const objectStore = transaction.objectStore('media');
            objectStore.delete(id);

            transaction.oncomplete = () => {
                showNotification('Medya silindi', 'success');
                loadLibrary();
                updateStats();
            };
        }

        function playVideo(id) {
            const transaction = mediaDB.transaction(['media'], 'readonly');
            const objectStore = transaction.objectStore('media');
            const request = objectStore.get(id);

            request.onsuccess = (event) => {
                const item = event.target.result;
                currentVideoBlob = item.blob;
                currentVideoId = id;

                const url = URL.createObjectURL(item.blob);
                const video = document.getElementById('modalVideo');
                video.src = url;

                document.getElementById('videoPlayerTitle').textContent = item.name;
                document.getElementById('videoPlayerModal').classList.add('active');
            };
        }

        function viewImage(id) {
            downloadMedia(id); // For simplicity, just download it
        }

        function closeVideoPlayer() {
            document.getElementById('videoPlayerModal').classList.remove('active');
            const video = document.getElementById('modalVideo');
            video.pause();
            video.src = '';
        }

        function downloadCurrentVideo() {
            if (currentVideoId) {
                downloadMedia(currentVideoId);
            }
        }

        function deleteCurrentVideo() {
            if (currentVideoId) {
                deleteMedia(currentVideoId);
                closeVideoPlayer();
            }
        }

        function refreshLibrary() {
            loadLibrary();
            showNotification('K√ºt√ºphane yenilendi', 'success');
        }

        function clearAllMedia() {
            if (!confirm('T√ºm kayƒ±tlarƒ± ve ekran g√∂r√ºnt√ºlerini silmek istediƒüinizden emin misiniz?')) return;

            const transaction = mediaDB.transaction(['media'], 'readwrite');
            const objectStore = transaction.objectStore('media');
            objectStore.clear();

            transaction.oncomplete = () => {
                showNotification('T√ºm medya silindi', 'success');
                loadLibrary();
                updateStats();
            };
        }

        function filterLibrary() {
            // Implementation for filtering and searching
            loadLibrary();
        }

        function sortLibrary() {
            // Implementation for sorting
            loadLibrary();
        }

        // Settings Functions
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            loadSettings();
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function loadSettings() {
            // Load settings from localStorage
            const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');

            if (settings.autoSave !== undefined) {
                document.getElementById('autoSave').checked = settings.autoSave;
            }
            if (settings.showNotifications !== undefined) {
                document.getElementById('showNotifications').checked = settings.showNotifications;
            }
            if (settings.filenamePattern) {
                document.getElementById('filenamePattern').value = settings.filenamePattern;
            }
        }

        function saveSettings() {
            const settings = {
                autoSave: document.getElementById('autoSave').checked,
                showNotifications: document.getElementById('showNotifications').checked,
                filenamePattern: document.getElementById('filenamePattern').value,
                maxCacheSize: document.getElementById('maxCacheSize').value,
                autoDeleteDays: document.getElementById('autoDeleteDays').value
            };

            localStorage.setItem('appSettings', JSON.stringify(settings));
            showNotification('Ayarlar kaydedildi', 'success');
            closeSettings();
        }

        function exportSettings() {
            const settings = localStorage.getItem('appSettings');
            const blob = new Blob([settings], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'screen-capture-settings.json';
            a.click();
            showNotification('Ayarlar dƒ±≈üa aktarƒ±ldƒ±', 'success');
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const settings = JSON.parse(event.target.result);
                        localStorage.setItem('appSettings', JSON.stringify(settings));
                        loadSettings();
                        showNotification('Ayarlar i√ße aktarƒ±ldƒ±', 'success');
                    } catch (error) {
                        showNotification('Ge√ßersiz ayar dosyasƒ±', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function clearCache() {
            if (confirm('√ñnbelleƒüi temizlemek istediƒüinizden emin misiniz?')) {
                localStorage.clear();
                showNotification('√ñnbellek temizlendi', 'success');
            }
        }

        function updateStats() {
            if (!mediaDB) return;

            const transaction = mediaDB.transaction(['media'], 'readonly');
            const objectStore = transaction.objectStore('media');
            const request = objectStore.getAll();

            request.onsuccess = (event) => {
                const items = event.target.result;

                const recordings = items.filter(i => i.type === 'video');
                const screenshots = items.filter(i => i.type === 'image');
                const totalSize = items.reduce((sum, i) => sum + i.size, 0);

                document.getElementById('totalRecordings').textContent = recordings.length;
                document.getElementById('totalScreenshots').textContent = screenshots.length;
                document.getElementById('totalStorage').textContent = formatFileSize(totalSize);
            };
        }

        // Help Functions
        function openHelp() {
            document.getElementById('helpModal').classList.add('active');
        }

        function closeHelp() {
            document.getElementById('helpModal').classList.remove('active');
        }

        // Drawing Mode
        function toggleDrawingMode() {
            if (!mediaRecorder || mediaRecorder.state !== 'recording') {
                showNotification('√áizim modu sadece kayƒ±t sƒ±rasƒ±nda kullanƒ±labilir', 'warning');
                return;
            }

            isDrawingModeActive = !isDrawingModeActive;

            if (isDrawingModeActive) {
                // Create live drawing canvas
                const previewVideo = document.getElementById('previewVideo');
                const videoRect = previewVideo.getBoundingClientRect();

                // Create canvas overlay on preview
                liveDrawingCanvas = document.createElement('canvas');

                // Set canvas size based on composite canvas if available, otherwise use video dimensions
                if (compositeCanvas) {
                    liveDrawingCanvas.width = compositeCanvas.width;
                    liveDrawingCanvas.height = compositeCanvas.height;
                } else if (previewVideo.videoWidth && previewVideo.videoHeight) {
                    liveDrawingCanvas.width = previewVideo.videoWidth;
                    liveDrawingCanvas.height = previewVideo.videoHeight;
                } else {
                    // Fallback to common resolution
                    liveDrawingCanvas.width = 1920;
                    liveDrawingCanvas.height = 1080;
                }

                liveDrawingCanvas.id = 'liveDrawingCanvas';
                liveDrawingCanvas.style.position = 'absolute';
                liveDrawingCanvas.style.top = '0';
                liveDrawingCanvas.style.left = '0';
                liveDrawingCanvas.style.width = '100%';
                liveDrawingCanvas.style.height = '100%';
                liveDrawingCanvas.style.cursor = 'crosshair';
                liveDrawingCanvas.style.pointerEvents = 'auto';

                liveDrawingContext = liveDrawingCanvas.getContext('2d');
                liveDrawingContext.lineCap = 'round';
                liveDrawingContext.lineJoin = 'round';

                // Add canvas to preview area
                const previewArea = document.getElementById('previewArea');
                previewArea.style.position = 'relative';
                previewArea.appendChild(liveDrawingCanvas);

                // Add drawing event listeners
                liveDrawingCanvas.addEventListener('mousedown', startLiveDrawing);
                liveDrawingCanvas.addEventListener('mousemove', performLiveDrawing);
                liveDrawingCanvas.addEventListener('mouseup', stopLiveDrawing);
                liveDrawingCanvas.addEventListener('mouseleave', stopLiveDrawing);

                // Show drawing toolbar
                showLiveDrawingToolbar();

                showNotification('√áizim modu aktif - √ñnizleme √ºzerine √ßizim yapabilirsiniz', 'success');
            } else {
                // Remove live drawing canvas
                const existingCanvas = document.getElementById('liveDrawingCanvas');
                if (existingCanvas) {
                    existingCanvas.remove();
                }

                // Hide drawing toolbar
                hideLiveDrawingToolbar();

                showNotification('√áizim modu kapatƒ±ldƒ±', 'info');
            }
        }

        // Live drawing event handlers
        function startLiveDrawing(e) {
            isLiveDrawing = true;
            const rect = liveDrawingCanvas.getBoundingClientRect();
            const scaleX = liveDrawingCanvas.width / rect.width;
            const scaleY = liveDrawingCanvas.height / rect.height;

            liveLastX = (e.clientX - rect.left) * scaleX;
            liveLastY = (e.clientY - rect.top) * scaleY;

            if (liveDrawingTool === 'text') {
                const text = prompt('Metin girin:');
                if (text) {
                    liveDrawingContext.fillStyle = liveDrawingColor;
                    liveDrawingContext.font = `${liveDrawingSize * 10}px Arial`;
                    liveDrawingContext.fillText(text, liveLastX, liveLastY);
                }
                isLiveDrawing = false;
            }
        }

        function performLiveDrawing(e) {
            if (!isLiveDrawing || liveDrawingTool === 'text') return;

            const rect = liveDrawingCanvas.getBoundingClientRect();
            const scaleX = liveDrawingCanvas.width / rect.width;
            const scaleY = liveDrawingCanvas.height / rect.height;

            const currentX = (e.clientX - rect.left) * scaleX;
            const currentY = (e.clientY - rect.top) * scaleY;

            liveDrawingContext.strokeStyle = liveDrawingColor;
            liveDrawingContext.lineWidth = liveDrawingSize;

            if (liveDrawingTool === 'pen') {
                liveDrawingContext.globalAlpha = 1;
                liveDrawingContext.beginPath();
                liveDrawingContext.moveTo(liveLastX, liveLastY);
                liveDrawingContext.lineTo(currentX, currentY);
                liveDrawingContext.stroke();
            } else if (liveDrawingTool === 'highlighter') {
                liveDrawingContext.globalAlpha = 0.3;
                liveDrawingContext.lineWidth = liveDrawingSize * 3;
                liveDrawingContext.beginPath();
                liveDrawingContext.moveTo(liveLastX, liveLastY);
                liveDrawingContext.lineTo(currentX, currentY);
                liveDrawingContext.stroke();
                liveDrawingContext.globalAlpha = 1;
            } else if (liveDrawingTool === 'arrow') {
                // Arrows are drawn on mouseup
            } else if (liveDrawingTool === 'rectangle') {
                // Rectangles are drawn on mouseup
            } else if (liveDrawingTool === 'circle') {
                // Circles are drawn on mouseup
            }

            liveLastX = currentX;
            liveLastY = currentY;
        }

        function stopLiveDrawing(e) {
            if (!isLiveDrawing) return;

            const rect = liveDrawingCanvas.getBoundingClientRect();
            const scaleX = liveDrawingCanvas.width / rect.width;
            const scaleY = liveDrawingCanvas.height / rect.height;

            const currentX = (e.clientX - rect.left) * scaleX;
            const currentY = (e.clientY - rect.top) * scaleY;

            liveDrawingContext.strokeStyle = liveDrawingColor;
            liveDrawingContext.fillStyle = liveDrawingColor;
            liveDrawingContext.lineWidth = liveDrawingSize;

            if (liveDrawingTool === 'arrow') {
                drawArrow(liveDrawingContext, liveLastX, liveLastY, currentX, currentY);
            } else if (liveDrawingTool === 'rectangle') {
                const width = currentX - liveLastX;
                const height = currentY - liveLastY;
                liveDrawingContext.strokeRect(liveLastX, liveLastY, width, height);
            } else if (liveDrawingTool === 'circle') {
                const radius = Math.sqrt(Math.pow(currentX - liveLastX, 2) + Math.pow(currentY - liveLastY, 2));
                liveDrawingContext.beginPath();
                liveDrawingContext.arc(liveLastX, liveLastY, radius, 0, Math.PI * 2);
                liveDrawingContext.stroke();
            }

            isLiveDrawing = false;
        }

        // Drawing toolbar functions
        function showLiveDrawingToolbar() {
            let toolbar = document.getElementById('liveDrawingToolbar');
            if (!toolbar) {
                toolbar = document.createElement('div');
                toolbar.id = 'liveDrawingToolbar';
                toolbar.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0, 0, 0, 0.9);
                    padding: 15px;
                    border-radius: 12px;
                    display: flex;
                    gap: 10px;
                    align-items: center;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                `;

                toolbar.innerHTML = `
                    <button onclick="setLiveDrawingTool('pen')" class="btn btn-sm" style="padding: 8px 12px;" title="Kalem">üñäÔ∏è</button>
                    <button onclick="setLiveDrawingTool('highlighter')" class="btn btn-sm" style="padding: 8px 12px;" title="Fosforlu Kalem">üñçÔ∏è</button>
                    <button onclick="setLiveDrawingTool('arrow')" class="btn btn-sm" style="padding: 8px 12px;" title="Ok">‚û°Ô∏è</button>
                    <button onclick="setLiveDrawingTool('rectangle')" class="btn btn-sm" style="padding: 8px 12px;" title="Dikd√∂rtgen">‚ñ≠</button>
                    <button onclick="setLiveDrawingTool('circle')" class="btn btn-sm" style="padding: 8px 12px;" title="Daire">‚≠ï</button>
                    <button onclick="setLiveDrawingTool('text')" class="btn btn-sm" style="padding: 8px 12px;" title="Metin">T</button>
                    <input type="color" id="liveDrawColor" value="${liveDrawingColor}" onchange="liveDrawingColor = this.value" style="width: 40px; height: 36px; border: none; border-radius: 6px; cursor: pointer;">
                    <input type="range" id="liveDrawSize" min="1" max="10" value="${liveDrawingSize}" onchange="liveDrawingSize = parseInt(this.value)" style="width: 100px;">
                    <button onclick="clearLiveDrawing()" class="btn btn-sm btn-outline" style="padding: 8px 12px;" title="Temizle">üóëÔ∏è</button>
                `;

                document.body.appendChild(toolbar);
            }
            toolbar.style.display = 'flex';
        }

        function hideLiveDrawingToolbar() {
            const toolbar = document.getElementById('liveDrawingToolbar');
            if (toolbar) {
                toolbar.style.display = 'none';
            }
        }

        function setLiveDrawingTool(tool) {
            liveDrawingTool = tool;
            showNotification(`Ara√ß: ${tool}`, 'info');
        }

        function clearLiveDrawing() {
            if (liveDrawingContext) {
                liveDrawingContext.clearRect(0, 0, liveDrawingCanvas.width, liveDrawingCanvas.height);
                showNotification('√áizimler temizlendi', 'success');
            }
        }

        // Helper function to draw arrows
        function drawArrow(ctx, fromX, fromY, toX, toY) {
            const headLength = 15;
            const angle = Math.atan2(toY - fromY, toX - fromX);

            // Draw line
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();

            // Draw arrow head
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLength * Math.cos(angle - Math.PI / 6), toY - headLength * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), toY - headLength * Math.sin(angle + Math.PI / 6));
            ctx.stroke();
        }

        // Range Input Updates
        function updateRangeDisplays() {
            const ranges = [
                { id: 'bitrate', suffix: ' Mbps' },
                { id: 'systemVolume', suffix: '%' },
                { id: 'micVolume', suffix: '%' },
                { id: 'jpgQuality', suffix: '%' },
                { id: 'brightness', suffix: '%' },
                { id: 'contrast', suffix: '%' },
                { id: 'saturation', suffix: '%' }
            ];

            ranges.forEach(range => {
                const input = document.getElementById(range.id);
                const display = document.getElementById(range.id + 'Value');

                if (input && display) {
                    input.addEventListener('input', () => {
                        display.textContent = input.value + range.suffix;

                        // Apply filter changes in real-time
                        if (['brightness', 'contrast', 'saturation'].includes(range.id)) {
                            applyFilter('none');
                        }
                    });
                }
            });
        }

        function updateFilterDisplay() {
            document.getElementById('brightnessValue').textContent = document.getElementById('brightness').value + '%';
            document.getElementById('contrastValue').textContent = document.getElementById('contrast').value + '%';
            document.getElementById('saturationValue').textContent = document.getElementById('saturation').value + '%';
        }

        // Export format change
        document.getElementById('exportFormat')?.addEventListener('change', (e) => {
            const jpgGroup = document.getElementById('jpgQualityGroup');
            if (e.target.value === 'jpg') {
                jpgGroup.classList.remove('hidden');
            } else {
                jpgGroup.classList.add('hidden');
            }
        });

        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl+Shift+R: Start/Stop recording
            if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                e.preventDefault();
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    stopRecording();
                } else {
                    startRecording();
                }
            }

            // Ctrl+Shift+P: Pause/Resume
            if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                pauseRecording();
            }

            // Ctrl+Shift+S: Screenshot
            if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                takeScreenshot();
            }

            // Ctrl+Shift+D: Drawing mode
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                toggleDrawingMode();
            }

            // Esc: Cancel/Stop
            if (e.key === 'Escape') {
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    stopRecording();
                }
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            initDB();
            updateRangeDisplays();

            // Check for browser compatibility
            if (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {
                showNotification('Tarayƒ±cƒ±nƒ±z ekran kaydƒ±nƒ± desteklemiyor. L√ºtfen g√ºncel bir tarayƒ±cƒ± kullanƒ±n.', 'error');
            }
        });

        // Prevent closing during recording
        window.addEventListener('beforeunload', (e) => {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                e.preventDefault();
                e.returnValue = '';
                return 'Kayƒ±t devam ediyor. √áƒ±kmak istediƒüinizden emin misiniz?';
            }
        });
    </script>
</body>
</html>