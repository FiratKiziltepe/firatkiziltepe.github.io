<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Define Your Goal - TeachAI Navigator</title>
    <style>
        /* --- Global Styles & Variables (Same as previous) --- */
        :root {
            --primary-color: #4A90E2; /* Trustworthy Blue */
            --secondary-color: #F5A623; /* Encouraging Orange */
            --light-bg: #F5F5F5;
            --text-dark: #333333;
            --text-light: #FFFFFF;
            --border-color: #CCCCCC;
            --card-bg: #FFFFFF;
            --font-heading: 'Nunito', sans-serif;
            --font-body: 'Open Sans', sans-serif;
        }

        /* Basic Reset & Font Setup (Same as previous) */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-body); color: var(--text-dark); line-height: 1.6; background-color: var(--light-bg); }
        h1, h2, h3, h4, h5, h6 { font-family: var(--font-heading); margin-bottom: 0.75em; color: var(--primary-color); }
        h1 { font-size: 2.5rem; } h2 { font-size: 1.8rem; } h3 { font-size: 1.2rem; }
        p { margin-bottom: 1em; }
        a { color: var(--primary-color); text-decoration: none; }
        a:hover { text-decoration: underline; }
        img { max-width: 100%; height: auto; display: block; }
        .container { max-width: 1000px; margin: 0 auto; padding: 0 20px; }
        button { cursor: pointer; }

        /* --- Header / Top Navigation (Same as previous) --- */
        .top-nav { background-color: var(--text-light); padding: 1rem 0; border-bottom: 1px solid var(--border-color); position: sticky; top: 0; z-index: 1000; }
        .top-nav .container { max-width: 1200px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .logo { font-family: var(--font-heading); font-size: 1.8rem; font-weight: bold; color: var(--primary-color); margin-right: 2rem; }
        .logo a { text-decoration: none; }
        .main-nav ul, .user-nav ul { list-style: none; display: flex; align-items: center; }
        .main-nav li, .user-nav li { margin-left: 1.5rem; }
        .main-nav a, .user-nav a { font-weight: bold; font-size: 0.95rem; text-decoration: none; padding: 0.5rem 0; transition: color 0.3s ease; }
        .main-nav a:hover, .user-nav a:hover { color: var(--secondary-color); text-decoration: none; }
        .search-bar { display: flex; margin-left: 2rem; }
        .search-bar input[type="search"] { padding: 0.5rem 0.8rem; border: 1px solid var(--border-color); border-radius: 4px 0 0 4px; min-width: 200px; }
        .search-bar button { padding: 0.5rem 1rem; border: 1px solid var(--primary-color); background-color: var(--primary-color); color: var(--text-light); border-radius: 0 4px 4px 0; cursor: pointer; transition: background-color 0.3s ease; }
        .search-bar button:hover { background-color: #3a7ac0; }

        /* --- Main Content Area (Same as previous) --- */
        main { padding: 40px 0; }
        .goal-definition-flow { background-color: var(--card-bg); padding: 30px 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .step-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid var(--primary-color); }
        .step-number { background-color: var(--primary-color); color: var(--text-light); font-size: 1.5rem; font-weight: bold; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .step-header h2 { margin: 0; font-size: 1.6rem; }
        #step-1-goal-selection h3 { font-size: 1.3rem; color: var(--text-dark); margin-bottom: 1rem; }
        .guided-goals-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .goal-card { background-color: #f9f9f9; border: 1px solid var(--border-color); border-radius: 8px; padding: 20px 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 140px; }
        .goal-card:hover { border-color: var(--primary-color); box-shadow: 0 4px 10px rgba(0,0,0,0.1); transform: translateY(-3px); background-color: #eaf2fb; }
        .goal-card .icon { font-size: 2.5rem; margin-bottom: 15px; color: var(--primary-color); }
        .goal-card span { font-weight: bold; font-size: 1rem; line-height: 1.3; color: var(--text-dark); }
        .separator { text-align: center; margin: 30px 0; font-weight: bold; color: #888; display: flex; align-items: center; gap: 15px; }
        .separator::before, .separator::after { content: ''; flex-grow: 1; height: 1px; background-color: var(--border-color); }
        #free-text-goal-form label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 1.1rem; }
        #free-text-goal-form textarea { width: 100%; min-height: 80px; padding: 12px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 1rem; font-family: var(--font-body); margin-bottom: 15px; resize: vertical; }
        #free-text-goal-form button { background-color: var(--secondary-color); color: var(--text-light); padding: 0.8rem 1.8rem; border: none; border-radius: 4px; font-size: 1rem; font-weight: bold; transition: background-color 0.3s ease; }
        #free-text-goal-form button:hover { background-color: #e4961a; }
        #api-feedback { margin-top: 20px; padding: 15px; border: 1px dashed var(--border-color); border-radius: 4px; background-color: var(--light-bg); min-height: 50px; display: none; }
        #api-feedback.loading { display: flex; align-items: center; justify-content: center; color: #555; font-style: italic; }
        #api-feedback .spinner { display: inline-block; margin-right: 10px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #api-feedback p { margin: 0 0 10px 0; }
        #api-feedback button { background-color: var(--primary-color); color: var(--text-light); padding: 0.5rem 1rem; border: none; border-radius: 4px; font-size: 0.9rem; margin-top: 5px; transition: background-color 0.3s ease; }
        #api-feedback button:hover { background-color: #3a7ac0; }
        #step-2-refinement { display: none; }
        .refinement-form fieldset { border: none; padding: 0; margin: 0; }
        .refinement-form .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .refinement-form .form-group label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 0.95rem; }
        .refinement-form .form-group label span.optional { font-weight: normal; font-size: 0.8em; color: #777; }
        .refinement-form .form-group input[type="text"], .refinement-form .form-group select { width: 100%; padding: 0.7rem 0.9rem; border: 1px solid var(--border-color); border-radius: 4px; font-size: 0.95rem; }
        .refinement-form button#submit-goal { background-color: var(--secondary-color); color: var(--text-light); padding: 0.8rem 2rem; border: none; border-radius: 4px; font-size: 1.1rem; font-weight: bold; transition: background-color 0.3s ease; display: block; margin: 20px auto 0 auto; }
        .refinement-form button#submit-goal:hover { background-color: #e4961a; }

        /* --- NEW: Modal Styles --- */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1001; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            padding-top: 50px; /* Location of the box */
            padding-bottom: 50px;
        }

        .modal-content {
            background-color: var(--card-bg);
            margin: auto;
            padding: 30px 40px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            max-width: 750px;
            width: 90%;
            max-height: 85vh; /* Limit height */
            overflow-y: auto; /* Add scroll for content */
            position: relative;
        }

        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            background: none;
            border: none;
            line-height: 1;
        }
        .modal-close-btn:hover,
        .modal-close-btn:focus {
            color: var(--text-dark);
            text-decoration: none;
            cursor: pointer;
            outline: none;
        }

        /* Roadmap Specific Styles */
        .modal-content h2 { /* Modal Title */
             font-size: 1.6rem;
             margin-bottom: 5px;
             border-bottom: 1px solid var(--border-color);
             padding-bottom: 10px;
        }
         .modal-content .goal-context {
             font-size: 0.9rem;
             color: #666;
             margin-bottom: 25px;
         }

        .roadmap-step {
            border: 1px solid #e0e0e0;
            background-color: #fdfdfd;
            border-radius: 6px;
            padding: 15px 20px;
            margin-bottom: 20px;
        }
        .roadmap-step h3 { /* Step title */
            font-size: 1.25rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        .roadmap-step p { /* Step description */
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        .suggested-tools h4 {
            font-size: 1rem;
            color: var(--text-dark);
            margin-bottom: 10px;
            border-top: 1px dashed var(--border-color);
            padding-top: 15px;
        }
        .tool-suggestion {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        .tool-suggestion strong {
            font-size: 0.95rem;
            color: var(--primary-color);
        }
        .tool-suggestion a {
            font-size: 0.85rem;
            margin-left: 10px;
            color: var(--secondary-color);
            font-weight: bold;
        }
        .tool-suggestion .tip {
             display: block;
             font-size: 0.85rem;
             font-style: italic;
             color: #555;
             margin-top: 5px;
        }


        /* Footer (Same as previous) */
        .site-footer { background-color: #333; color: #ccc; padding: 30px 0; margin-top: 40px; font-size: 0.9rem; }
        .site-footer .container { max-width: 1200px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .footer-nav ul { list-style: none; display: flex; flex-wrap: wrap; }
        .footer-nav li { margin-right: 1.5rem; margin-bottom: 0.5rem; }
        .footer-nav a { color: #ccc; }
        .footer-nav a:hover { color: var(--text-light); }
        .footer-copy { margin-top: 10px; flex-basis: 100%; text-align: center; }

        /* Accessibility (Same as previous) */
        a:focus, button:focus, input:focus, select:focus, textarea:focus { outline: 2px solid var(--secondary-color); outline-offset: 2px; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }

        /* --- Responsive Design (Adapting modal/other styles) --- */
        @media (max-width: 992px) {
            /* Nav adjustments */
            .top-nav .container { flex-direction: column; align-items: flex-start; }
            .main-nav, .user-nav, .search-bar { margin-top: 1rem; margin-left: 0; width: 100%; }
            .main-nav ul, .user-nav ul { flex-direction: column; align-items: flex-start; width: 100%; }
            .main-nav li, .user-nav li { margin-left: 0; margin-bottom: 0.5rem; width: 100%; }
            .search-bar { justify-content: flex-start; }
            .search-bar input[type="search"] { flex-grow: 1; }
        }
         @media (max-width: 768px) {
            /* Text size, padding */
            h1 { font-size: 2rem; } h2 { font-size: 1.6rem; }
            .goal-definition-flow { padding: 20px; }
            .step-header { gap: 10px; }
            .step-number { width: 40px; height: 40px; font-size: 1.3rem; }
            .guided-goals-container { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
            .refinement-form .form-grid { grid-template-columns: 1fr; gap: 20px; }
            /* Modal adjustments */
            .modal-content { padding: 20px; width: 95%; max-height: 90vh; }
            .modal-close-btn { top: 5px; right: 10px; }
            /* Footer adjustments */
            .site-footer .container { flex-direction: column; text-align: center; }
            .footer-nav ul { justify-content: center; margin-bottom: 1rem; }
            .footer-nav li { margin: 0 0.75rem 0.5rem; }
            .footer-copy { margin-top: 0; }
         }

    </style>
    <!-- Link Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Navigation, Main Content (Steps 1 & 2) remain the same as previous version -->
    <!-- ... (HTML from previous version for header, main, step 1, step 2) ... -->

    <!-- 1. Top Navigation Bar (Persistent) -->
    <header class="top-nav">
        <div class="container">
           <div class="logo"><a href="index.html">TeachAI Navigator</a></div>
           <nav class="main-nav" aria-label="Main navigation">
               <ul>
                   <li><a href="index.html#goals">Explore Goals</a></li>
                   <li><a href="tool-database.html">Browse AI Tools</a></li>
                   <li><a href="learn-hub.html">Learn</a></li>
                   <li><a href="#community">Community</a></li>
               </ul>
           </nav>
           <form class="search-bar" role="search">
               <label for="global-search" class="sr-only">Search TeachAI Navigator</label>
               <input type="search" id="global-search" placeholder="Search goals, tools, resources...">
               <button type="submit">Search</button>
           </form>
           <nav class="user-nav" aria-label="User account">
               <ul>
                   <li><a href="#login">Login</a></li>
                   <li><a href="#signup">Sign Up</a></li>
               </ul>
           </nav>
       </div>
    </header>

    <!-- 2. Main Content Area (Goal Definition Flow) -->
    <main>
        <div class="container">
             <h1>Define Your Educational Goal</h1>

             <div class="goal-definition-flow">

                <!-- Step 1: Goal Selection / Input (Remains the same) -->
                <section id="step-1-goal-selection" aria-labelledby="step-1-heading">
                    <div class="step-header">
                        <span class="step-number">1</span>
                        <h2 id="step-1-heading">What do you want to achieve?</h2>
                    </div>
                    <h3>Select a common goal:</h3>
                    <div class="guided-goals-container">
                        <div class="goal-card" data-goal="Create a Lesson Plan" tabindex="0" role="button"><span class="icon">📝</span><span>Create a Lesson Plan</span></div>
                        <div class="goal-card" data-goal="Generate Quiz Questions" tabindex="0" role="button"><span class="icon">❓</span><span>Generate Quiz Questions</span></div>
                        <div class="goal-card" data-goal="Design Presentation Visuals" tabindex="0" role="button"><span class="icon">🖼️</span><span>Design Presentation Visuals</span></div>
                        <div class="goal-card" data-goal="Create Practice Problems" tabindex="0" role="button"><span class="icon">🧮</span><span>Create Practice Problems</span></div>
                        <div class="goal-card" data-goal="Summarize Text" tabindex="0" role="button"><span class="icon">✂️</span><span>Summarize Text</span></div>
                        <div class="goal-card" data-goal="Generate Explanations" tabindex="0" role="button"><span class="icon">💡</span><span>Generate Explanations</span></div>
                    </div>
                    <div class="separator">OR</div>
                    <form id="free-text-goal-form">
                        <label for="free-text-goal">Describe your goal in your own words:</label>
                        <textarea id="free-text-goal" name="free_text_goal" placeholder="e.g., 'Help my 7th graders understand photosynthesis better with visuals', 'Create a fun review game for WWII causes', 'Draft an email to parents about upcoming tests'..." required></textarea>
                        <button type="submit">Analyze Goal with AI</button>
                    </form>
                    <div id="api-feedback" role="status" aria-live="polite"></div>
                </section>

                <!-- Step 2: Refinement (Remains the same) -->
                <section id="step-2-refinement" aria-labelledby="step-2-heading">
                     <div class="step-header">
                        <span class="step-number">2</span>
                        <h2 id="step-2-heading">Refine Your Goal <span id="selected-goal-title" style="color: #555; font-size: 1.2rem;"></span></h2>
                    </div>
                    <form class="refinement-form" id="refinement-form">
                         <p>Adding context helps us tailor the guidance (Optional).</p>
                         <fieldset>
                            <legend class="sr-only">Goal Refinement Options</legend>
                            <div class="form-grid">
                                <div class="form-group"><label for="subject">Subject <span class="optional">(Optional)</span></label><select id="subject" name="subject"><option value="">Select Subject...</option><option value="math">Math</option><option value="science">Science</option><option value="history">History</option><option value="ela">English Language Arts</option><option value="art">Art</option><option value="technology">Technology</option><option value="other">Other</option></select></div>
                                <div class="form-group"><label for="grade-level">Grade Level <span class="optional">(Optional)</span></label><select id="grade-level" name="grade_level"><option value="">Select Grade Level...</option><option value="k-2">K-2</option><option value="3-5">3-5</option><option value="6-8">6-8</option><option value="9-12">9-12</option><option value="higher-ed">Higher Education</option><option value="professional">Professional Development</option><option value="any">Any</option></select></div>
                                <div class="form-group"><label for="specific-topic">Specific Topic <span class="optional">(Optional)</span></label><input type="text" id="specific-topic" name="specific_topic" placeholder="e.g., Photosynthesis, WWII Causes..."></div>
                            </div>
                         </fieldset>
                         <button type="submit" id="submit-goal">Show Me the Steps</button>
                    </form>
                </section>

             </div> <!-- /.goal-definition-flow -->
        </div> <!-- /.container -->
    </main>

    <!-- NEW: Roadmap Modal HTML (Initially Hidden) -->
    <div id="roadmap-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" aria-label="Close modal">×</button>
            <h2 id="modal-goal-title">Guide: [Goal Title Here]</h2>
            <p class="goal-context" id="modal-goal-context">Subject: [Subject] | Grade Level: [Grade] | Topic: [Topic]</p>
            <div class="roadmap-steps" id="modal-roadmap-content">
                <!-- Roadmap steps will be dynamically inserted here by JavaScript -->
                 <p><em>Loading roadmap...</em></p>
            </div>
             <p style="font-size: 0.8em; color: #888; margin-top: 20px; text-align: center;"><em>Note: Tool suggestions and steps are examples. Always review AI output critically.</em></p>
        </div>
    </div>


    <!-- Footer (Remains the same as previous version) -->
    <footer class="site-footer">
        <!-- ... (Footer HTML from previous version) ... -->
          <div class="container">
             <nav class="footer-nav" aria-label="Footer navigation">
                <ul>
                    <li><a href="#about">About Us</a></li>
                    <li><a href="#contact">Contact</a></li>
                    <li><a href="#privacy">Privacy Policy</a></li>
                    <li><a href="#terms">Terms of Service</a></li>
                    <li><a href="#accessibility">Accessibility Statement</a></li>
                </ul>
             </nav>
             <div class="footer-copy">
                 © 2024 TeachAI Navigator. All rights reserved.
             </div>
        </div>
    </footer>


    <!-- JavaScript for Flow Control, API Sim & NEW Modal Logic -->
    <script>
        // References to elements (same as before + new modal elements)
        const step1Section = document.getElementById('step-1-goal-selection');
        const step2Section = document.getElementById('step-2-refinement');
        const goalCards = document.querySelectorAll('.goal-card');
        const freeTextForm = document.getElementById('free-text-goal-form');
        const freeTextInput = document.getElementById('free-text-goal');
        const apiFeedbackDiv = document.getElementById('api-feedback');
        const refinementForm = document.getElementById('refinement-form');
        const selectedGoalTitleSpan = document.getElementById('selected-goal-title');

        // NEW: Modal element references
        const roadmapModal = document.getElementById('roadmap-modal');
        const modalGoalTitle = document.getElementById('modal-goal-title');
        const modalGoalContext = document.getElementById('modal-goal-context');
        const modalRoadmapContent = document.getElementById('modal-roadmap-content');
        const modalCloseBtn = roadmapModal.querySelector('.modal-close-btn');


        let currentSelectedGoal = ''; // Store the goal chosen or suggested

        // --- Helper Function to Proceed to Step 2 (Same as before) ---
        function proceedToStep2(goalName) { /* ... same code ... */
             currentSelectedGoal = goalName;
            selectedGoalTitleSpan.textContent = `for: ${goalName}`; // Update Step 2 title
            step1Section.style.display = 'none';
            step2Section.style.display = 'block';
            step2Section.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to Step 2
             // Focus first element in step 2 for accessibility
            const firstInput = step2Section.querySelector('select, input');
            if (firstInput) {
                firstInput.focus();
            }
        }

        // --- Event Listener for Guided Goal Cards (Same as before) ---
        goalCards.forEach(card => { /* ... same code ... */
             // Handle click
            card.addEventListener('click', () => {
                const goalName = card.dataset.goal;
                proceedToStep2(goalName);
            });
            // Handle keyboard Enter/Space press for accessibility
            card.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault(); // Prevent default space scrolling
                    const goalName = card.dataset.goal;
                    proceedToStep2(goalName);
                }
            });
        });

        // --- Event Listener for Free Text Form Submission (API Simulation) (Same as before) ---
        freeTextForm.addEventListener('submit', (event) => { /* ... same code ... */
            event.preventDefault(); // Prevent actual form submission
            const userGoalText = freeTextInput.value.trim();

            if (!userGoalText) {
                apiFeedbackDiv.innerHTML = '<p style="color: red;">Please describe your goal.</p>';
                apiFeedbackDiv.style.display = 'block';
                return;
            }

            // ** START: Gemini API Simulation **
            apiFeedbackDiv.innerHTML = '<span class="spinner">⚙️</span> Analyzing your goal with AI...';
            apiFeedbackDiv.className = 'loading'; // Use class for styling
            apiFeedbackDiv.style.display = 'flex'; // Ensure display is set correctly for loading


            // Simulate network delay
            setTimeout(() => {
                console.log(`Simulating API call for: "${userGoalText}"`);
                apiFeedbackDiv.className = ''; // Reset class
                apiFeedbackDiv.style.display = 'block'; // Ensure it's visible

                // --- Basic Keyword Matching (SIMULATION ONLY) ---
                let suggestedGoal = 'Unclear';
                const lowerText = userGoalText.toLowerCase();
                // (Keyword matching logic remains the same as previous)
                 if (lowerText.includes('lesson') || lowerText.includes('plan')) { suggestedGoal = 'Create a Lesson Plan'; }
                 else if (lowerText.includes('quiz') || lowerText.includes('test') || lowerText.includes('assessment') || lowerText.includes('question')) { suggestedGoal = 'Generate Quiz Questions'; }
                 else if (lowerText.includes('visual') || lowerText.includes('image') || lowerText.includes('graphic') || lowerText.includes('presentation') || lowerText.includes('slide')) { suggestedGoal = 'Design Presentation Visuals'; }
                 else if (lowerText.includes('practice') || lowerText.includes('problem') || lowerText.includes('worksheet')) { suggestedGoal = 'Create Practice Problems'; }
                 else if (lowerText.includes('summarize') || lowerText.includes('shorten') || lowerText.includes('condense')) { suggestedGoal = 'Summarize Text'; }
                 else if (lowerText.includes('explain') || lowerText.includes('understand') || lowerText.includes('concept')) { suggestedGoal = 'Generate Explanations'; }
                 else if (lowerText.includes('email') || lowerText.includes('parent') || lowerText.includes('communication')) { suggestedGoal = 'Draft Communications (Example)'; }

                // --- Display Simulated Results ---
                if (suggestedGoal !== 'Unclear') {
                    apiFeedbackDiv.innerHTML = `
                        <p><strong>AI Suggestion:</strong> Based on your description, this looks like the goal: <strong>${suggestedGoal}</strong></p>
                        <button id="accept-suggestion-btn" data-goal="${suggestedGoal}">Yes, use this goal</button>
                        <p style="font-size: 0.9em; margin-top: 10px;">(You can refine details in the next step).</p>
                        <p style="font-size: 0.8em; color: #666; margin-top: 5px;"><em>Note: This is an AI suggestion...</em></p>`;
                    document.getElementById('accept-suggestion-btn').addEventListener('click', (e) => {
                        proceedToStep2(e.target.dataset.goal);
                    });
                } else {
                    apiFeedbackDiv.innerHTML = `
                        <p><strong>AI Analysis:</strong> We couldn't confidently match your description...</p>
                        <p style="font-size: 0.9em;">Please try rephrasing or select a card.</p>
                        <p style="font-size: 0.8em; color: #666; margin-top: 5px;"><em>(AI analysis requires backend...).</em></p>`;
                }
            }, 1500);
        });


        // --- NEW: Function to Generate Roadmap HTML (Simulation) ---
        function generateRoadmapHTML(goal, subject, grade, topic) {
            let stepsHTML = '';
            // Sanitize inputs slightly for display/use in prompts
            const safeTopic = topic ? topic.replace(/</g, "<").replace(/>/g, ">") : 'the topic';
            const safeSubject = subject ? subject : 'your subject';
            const safeGrade = grade ? grade : 'your students';

            switch (goal) {
                case 'Design Presentation Visuals':
                    stepsHTML = `
                        <div class="roadmap-step">
                            <h3>Step 1: Define Visual Needs</h3>
                            <p>Clearly list the key concepts or stages of '${safeTopic}' that need visual representation for ${safeGrade}. What style is appropriate (e.g., simple illustration, diagram, photo)?</p>
                            <div class="suggested-tools"><h4>Suggested Tools:</h4>
                                <div class="tool-suggestion"><strong>Brainstorming/Text AI:</strong> Use ChatGPT, Claude, or Gemini to help list concepts.</div>
                            </div>
                        </div>
                        <div class="roadmap-step">
                            <h3>Step 2: Generate Images</h3>
                            <p>Use an AI image generator to create visuals for each key concept.</p>
                            <div class="suggested-tools"><h4>Suggested Tools:</h4>
                                <div class="tool-suggestion"><strong>ChatGPT (DALL-E 3):</strong> <span class="tip">Tip: Prompt like 'Simple illustration of [concept from Step 1] for ${safeGrade} ${safeSubject}, educational style'.</span> <a href="https://chat.openai.com/" target="_blank">Visit</a></div>
                                <div class="tool-suggestion"><strong>Microsoft Designer / Image Creator (DALL-E 3):</strong> <span class="tip">Tip: Similar prompts. Often free with Microsoft account.</span> <a href="https://designer.microsoft.com/" target="_blank">Visit</a></div>
                                <div class="tool-suggestion"><strong>Adobe Firefly:</strong> <span class="tip">Tip: Good for specific styles and often trained on ethically sourced data.</span> <a href="https://firefly.adobe.com/" target="_blank">Visit</a></div>
                                <div class="tool-suggestion"><strong>Canva Magic Media:</strong> <span class="tip">Tip: Integrated directly within Canva designs.</span> <a href="https://www.canva.com/" target="_blank">Visit</a></div>
                            </div>
                        </div>
                        <div class="roadmap-step">
                            <h3>Step 3: Refine and Select</h3>
                            <p>Review the generated images for accuracy, clarity, and appropriateness. You might need to slightly edit them (cropping, adding text) or regenerate with better prompts.</p>
                            <div class="suggested-tools"><h4>Suggested Tools:</h4>
                                <div class="tool-suggestion"><strong>Basic Image Editor:</strong> Your computer's default editor, or tools like Canva/PowerPoint.</div>
                             </div>
                        </div>
                         <div class="roadmap-step">
                            <h3>Step 4: Integrate into Presentation</h3>
                            <p>Insert the selected visuals into your presentation slides, ensuring they align with your text content.</p>
                             <div class="suggested-tools"><h4>Suggested Tools:</h4>
                                <div class="tool-suggestion"><strong>Presentation Software:</strong> PowerPoint, Google Slides, Keynote, Canva.</div>
                             </div>
                        </div>`;
                    break;

                case 'Create a Lesson Plan':
                     stepsHTML = `
                        <div class="roadmap-step">
                            <h3>Step 1: Define Objectives & Outline</h3>
                            <p>Clearly state the learning objectives for '${safeTopic}' for ${safeGrade} in ${safeSubject}. Ask an AI to help create a basic lesson outline (e.g., Introduction, Activity 1, Assessment, Conclusion).</p>
                            <div class="suggested-tools"><h4>Suggested Tools:</h4>
                                <div class="tool-suggestion"><strong>ChatGPT / Claude / Gemini:</strong> <span class="tip">Tip: Prompt like 'Create learning objectives and a 4-part lesson outline for teaching ${safeTopic} to ${safeGrade} ${safeSubject}.'</span> </div>
                             </div>
                        </div>
                        <div class="roadmap-step">
                            <h3>Step 2: Generate Activities & Content Ideas</h3>
                            <p>Use AI to brainstorm or draft specific activities, discussion questions, or explanatory text based on your outline.</p>
                            <div class="suggested-tools"><h4>Suggested Tools:</h4>
                                <div class="tool-suggestion"><strong>ChatGPT / Claude / Gemini:</strong> <span class="tip">Tip: Prompt like 'Suggest 2 engaging activities for [part of outline] about ${safeTopic} for ${safeGrade}.'</span></div>
                                <div class="tool-suggestion"><strong>Diffit:</strong> <span class="tip">Tip: Can generate reading passages or adapt existing text for ${safeGrade}.</span> <a href="https://diffit.me/" target="_blank">Visit</a></div>
                            </div>
                        </div>
                         <div class="roadmap-step">
                            <h3>Step 3: Develop Assessment Methods</h3>
                            <p>Create formative or summative assessment questions or tasks to check understanding of '${safeTopic}'.</p>
                             <div class="suggested-tools"><h4>Suggested Tools:</h4>
                                <div class="tool-suggestion"><strong>ChatGPT / Claude / Gemini:</strong> <span class="tip">Tip: Prompt like 'Generate 5 multiple-choice questions about ${safeTopic} suitable for ${safeGrade}.'</span></div>
                                <div class="tool-suggestion"><strong>Quizizz AI / MagicSchool AI / Curipod:</strong> <span class="tip">Tip: Platforms specifically designed for AI-assisted question generation.</span></div>
                             </div>
                        </div>
                        <div class="roadmap-step">
                            <h3>Step 4: Format and Refine</h3>
                            <p>Assemble all generated components into a coherent lesson plan document. Review thoroughly for accuracy, flow, and alignment with objectives. **Always critically evaluate AI output.**</p>
                             <div class="suggested-tools"><h4>Suggested Tools:</h4>
                                <div class="tool-suggestion"><strong>Word Processor:</strong> Google Docs, Microsoft Word.</div>
                             </div>
                        </div>`;
                    break;

                 // Add cases for other goals ('Generate Quiz Questions', 'Summarize Text', etc.) here...
                 case 'Generate Quiz Questions':
                     stepsHTML = `<div class="roadmap-step"><h3>Step 1: Define Scope</h3><p>Specify the exact '${safeTopic}', learning objectives, and question types (MCQ, T/F, Short Answer) needed for ${safeGrade}.</p></div><div class="roadmap-step"><h3>Step 2: Generate Questions</h3><p>Use AI tools to generate questions based on your scope.</p><div class="suggested-tools"><h4>Suggested Tools:</h4><div class="tool-suggestion"><strong>ChatGPT/Claude/Gemini:</strong><span class="tip">Tip: 'Generate 5 [type] questions about [specific part of topic] for ${safeGrade}. Include answer keys.'</span></div><div class="tool-suggestion"><strong>Quizizz AI/MagicSchool/Curipod:</strong><span class="tip">Tip: Input topic or text to get questions.</span></div></div></div><div class="roadmap-step"><h3>Step 3: Review & Edit</h3><p>CRITICALLY review all questions and answers for accuracy, clarity, and bias. Edit as needed.</p></div>`;
                    break;


                default:
                    stepsHTML = `<p><em>Roadmap simulation for the goal "${goal}" is not yet implemented in this demo.</em></p>`;
            }
            return stepsHTML;
        }


        // --- Event Listener for Final Refinement Form Submission (MODIFIED) ---
        refinementForm.addEventListener('submit', (event) => {
            event.preventDefault(); // Prevent actual form submission

            // Get the final values from the form
            const subjectSelect = document.getElementById('subject');
            const gradeLevelSelect = document.getElementById('grade-level');
            const specificTopicInput = document.getElementById('specific-topic');

            const subjectValue = subjectSelect.value;
            const gradeLevelValue = gradeLevelSelect.value;
            const specificTopicValue = specificTopicInput.value.trim();

            // Get text representation for display
            const subjectText = subjectValue ? subjectSelect.options[subjectSelect.selectedIndex].text : 'Any';
            const gradeLevelText = gradeLevelValue ? gradeLevelSelect.options[gradeLevelSelect.selectedIndex].text : 'Any';
            const specificTopicText = specificTopicValue ? specificTopicValue : 'Not Specified';

            console.log('--- Generating Roadmap ---');
            console.log('Goal:', currentSelectedGoal, '| Subject:', subjectValue, '| Grade:', gradeLevelValue, '| Topic:', specificTopicValue);

            // Populate Modal Title and Context
            modalGoalTitle.textContent = `Guide: ${currentSelectedGoal}`;
            modalGoalContext.textContent = `Subject: ${subjectText} | Grade Level: ${gradeLevelText} | Topic: ${specificTopicText}`;

            // Generate and Populate Roadmap Steps
            const roadmapHTML = generateRoadmapHTML(currentSelectedGoal, subjectText, gradeLevelText, specificTopicText);
            modalRoadmapContent.innerHTML = roadmapHTML;

            // Show the Modal
            roadmapModal.style.display = 'block'; // Use block or flex depending on centering method in CSS
            document.body.style.overflow = 'hidden'; // Prevent background scrolling when modal is open

        });

        // --- NEW: Event Listeners for Closing the Modal ---
        // Close button
        modalCloseBtn.addEventListener('click', () => {
            roadmapModal.style.display = 'none';
            document.body.style.overflow = ''; // Restore background scrolling
        });

        // Click outside the modal content
        roadmapModal.addEventListener('click', (event) => {
            // If the clicked element is the modal background itself
            if (event.target === roadmapModal) {
                roadmapModal.style.display = 'none';
                document.body.style.overflow = ''; // Restore background scrolling
            }
        });

        // Optional: Close modal on Escape key press
        window.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && roadmapModal.style.display === 'block') {
                 roadmapModal.style.display = 'none';
                 document.body.style.overflow = ''; // Restore background scrolling
            }
        });


    </script>

</body>
</html>